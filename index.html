<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSE Brookasil - Sistema Eleitoral</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <style>
        :root {
            --cor-perola: #F8F9FA;
            --cor-safira: #1A5276;
            --cor-obsidiana: #1C2833;
            --cor-vidro: rgba(255, 255, 255, 0.1);
            --sombra-suave: 0 8px 32px rgba(0, 0, 0, 0.1);
            --borda-vidro: 1px solid rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--cor-obsidiana);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* Layout Assimétrico */
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 1024px) {
            .container {
                grid-template-columns: 280px 1fr;
                grid-template-areas: 
                    "sidebar main";
            }
        }

        /* Header e Navegação */
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, var(--cor-safira), #2E86C1);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: var(--sombra-suave);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-weight: 900;
            font-size: 2.2em;
            letter-spacing: -0.5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .logo-sub {
            font-weight: 300;
            font-size: 0.4em;
            opacity: 0.9;
        }

        /* Tabs Flutuantes */
        .tabs-flutuantes {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            background: white;
            padding: 10px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            z-index: 1000;
            gap: 5px;
        }

        .tab {
            padding: 12px 25px;
            border-radius: 50px;
            background: transparent;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab:hover {
            background: var(--cor-safira);
            color: white;
            transform: translateY(-2px);
        }

        .tab.ativo {
            background: linear-gradient(90deg, var(--cor-safira), #2E86C1);
            color: white;
        }

        /* Cartões Modernos (Efeito Vidro) */
        .cartao {
            background: var(--cor-vidro);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--sombra-suave);
            border: var(--borda-vidro);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .cartao:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .cartao-titulo {
            font-weight: 800;
            font-size: 1.5em;
            margin-bottom: 20px;
            color: var(--cor-safira);
            border-bottom: 2px solid rgba(26, 82, 118, 0.1);
            padding-bottom: 10px;
        }

        /* Dashboard - Tela Inicial */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .dashboard-numero {
            font-size: 3em;
            font-weight: 900;
            margin: 15px 0;
            color: var(--cor-safira);
        }

        /* Formulários */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--cor-obsidiana);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            transition: border 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--cor-safira);
        }

        .etapa-form {
            display: none;
        }

        .etapa-form.ativa {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Botões */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primario {
            background: linear-gradient(90deg, var(--cor-safira), #2E86C1);
            color: white;
        }

        .btn-primario:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(26, 82, 118, 0.4);
        }

        .btn-secundario {
            background: white;
            color: var(--cor-safira);
            border: 2px solid var(--cor-safira);
        }

        /* Listagem de Candidatos */
        .filtros {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .lista-candidatos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .candidato-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid var(--cor-safira);
        }

        .status-homologado { border-left-color: #27AE60; }
        .status-analise { border-left-color: #F39C12; }
        .status-recusado { border-left-color: #E74C3C; }

        /* Tipografia com Contraste */
        .texto-ultrafino {
            font-weight: 100;
            letter-spacing: 0.5px;
        }

        .texto-ultranegrito {
            font-weight: 900;
            letter-spacing: -0.5px;
        }

        /* Área Administrativa */
        .painel-admin {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .admin-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 30px;
        }

        .admin-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-weight: 700;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .admin-tab.ativo {
            color: var(--cor-safira);
            border-bottom: 3px solid var(--cor-safira);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .tabs-flutuantes {
                width: 90%;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 10px 15px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .filtros {
                flex-direction: column;
            }
        }

        /* Espaço em Branco Inteligente */
        .espaco-superior { margin-top: 40px; }
        .espaco-inferior { margin-bottom: 40px; }
        .espaco-lateral { padding-left: 20px; padding-right: 20px; }

        /* Micro-interações */
        .hover-lift:hover {
            transform: translateY(-3px);
            transition: transform 0.3s ease;
        }

        .transicao-suave {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cabeçalho -->
        <header class="header">
            <div>
                <div class="logo">TSE BROOKASIL <span class="logo-sub">SISTEMA ELEITORAL</span></div>
                <div class="texto-ultrafino" id="modoEleicao">Modo: Eleição Aberta</div>
            </div>
            <div id="areaLogin">
                <button class="btn btn-secundario" onclick="mostrarLogin()">Acesso Administrativo</button>
            </div>
        </header>

        <!-- Dashboard (Tela Inicial Sempre Visível) -->
        <section id="dashboard" class="cartao">
            <h2 class="cartao-titulo">Dashboard - Visão Geral</h2>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="texto-ultrafino">Candidatos Totais</div>
                    <div class="dashboard-numero" id="totalCandidatos">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="texto-ultrafino">Homologados</div>
                    <div class="dashboard-numero" id="homologados">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="texto-ultrafino">Em Análise</div>
                    <div class="dashboard-numero" id="emAnalise">0</div>
                </div>
                <div class="dashboard-card">
                    <div class="texto-ultrafino">Recusados</div>
                    <div class="dashboard-numero" id="recusados">0</div>
                </div>
            </div>
        </section>

        <!-- Conteúdo Principal -->
        <main>
            <!-- Seção de Candidatura -->
            <section id="candidatura" class="cartao" style="display: none;">
                <h2 class="cartao-titulo">Candidatura Pública</h2>
                
                <!-- Etapa 1 -->
                <div id="etapa1" class="etapa-form ativa">
                    <div class="form-group">
                        <label class="form-label">Nome completo</label>
                        <input type="text" class="form-input" id="nomeCandidato" placeholder="Nome e sobrenome">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">TikTok (@)</label>
                        <input type="text" class="form-input" id="tiktokCandidato" placeholder="@usuario">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tipo de Eleição</label>
                        <select class="form-select" id="tipoEleicao" onchange="filtrarCargos()">
                            <option value="">Selecione</option>
                            <option value="municipal">Municipal</option>
                            <option value="federal">Federal</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Cargo</label>
                        <select class="form-select" id="cargo" onchange="atualizarNumeroCandidato()">
                            <option value="">Primeiro selecione o tipo de eleição</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Estado/UF</label>
                        <select class="form-select" id="estado">
                            <option value="">Selecione</option>
                            <!-- Estados serão carregados via JS -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Município</label>
                        <input type="text" class="form-input" id="municipio" placeholder="Apenas para eleição municipal">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ideologia</label>
                        <select class="form-select" id="ideologia" onchange="filtrarPartidos()">
                            <option value="">Selecione</option>
                            <option value="direita">Direita</option>
                            <option value="centro">Centro</option>
                            <option value="esquerda">Esquerda</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Partido</label>
                        <select class="form-select" id="partido" onchange="atualizarNumeroCandidato()">
                            <option value="">Primeiro selecione a ideologia</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Número do Candidato</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="text" class="form-input" id="numeroCandidato" readonly style="flex: 1;">
                            <div id="infoNumero" style="font-size: 0.9em; color: #666;"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Foto</label>
                        <input type="file" class="form-input" id="fotoCandidato" accept="image/*">
                    </div>
                    
                    <!-- Coligação (Apenas para cargos de 2 dígitos) -->
                    <div class="form-group" id="coligacaoGroup" style="display: none;">
                        <label class="form-label">Coligação (Opcional - máximo 5 partidos)</label>
                        <div id="coligacaoContainer"></div>
                        <button type="button" class="btn btn-secundario" onclick="adicionarPartidoColigacao()" style="margin-top: 10px;">
                            + Adicionar Partido à Coligação
                        </button>
                    </div>
                    
                    <button class="btn btn-primario" onclick="avancarParaEtapa2()">Continuar</button>
                </div>
                
                <!-- Etapa 2 (Vice/Suplente) -->
                <div id="etapa2" class="etapa-form">
                    <h3 style="margin-bottom: 20px; color: var(--cor-safira);" id="tituloEtapa2"></h3>
                    
                    <div class="form-group">
                        <label class="form-label">Nome completo</label>
                        <input type="text" class="form-input" id="nomeViceSuplente" placeholder="Nome e sobrenome">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">TikTok (@)</label>
                        <input type="text" class="form-input" id="tiktokViceSuplente" placeholder="@usuario">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ideologia</label>
                        <select class="form-select" id="ideologiaViceSuplente" onchange="filtrarPartidosVice()">
                            <option value="">Selecione</option>
                            <option value="direita">Direita</option>
                            <option value="centro">Centro</option>
                            <option value="esquerda">Esquerda</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Partido</label>
                        <select class="form-select" id="partidoViceSuplente">
                            <option value="">Primeiro selecione a ideologia</option>
                        </select>
                    </div>
                    
                    <!-- Explicação sobre Suplente -->
                    <div id="explicacaoSuplente" style="display: none; background: #F8F9FA; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-weight: bold; color: var(--cor-safira);">O que é um suplente?</span>
                            <span style="cursor: help; font-size: 1.2em;">?</span>
                        </div>
                        <p style="font-size: 0.9em; color: #666;">
                            O suplente assume o cargo temporariamente quando o titular está licenciado ou definitivamente se o titular não puder mais exercer o mandato. Para deputados e vereadores, os suplentes são escolhidos em ordem definida pela votação.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-secundario" onclick="voltarParaEtapa1()">Voltar</button>
                        <button class="btn btn-primario" onclick="enviarCandidatura()">Enviar Candidatura</button>
                    </div>
                </div>
            </section>

            <!-- Listagem de Candidatos -->
            <section id="listagem" class="cartao" style="display: none;">
                <h2 class="cartao-titulo">Lista de Candidatos</h2>
                
                <div class="filtros">
                    <select class="form-select" id="filtroEstado" onchange="filtrarCandidatos()" style="flex: 1;">
                        <option value="">Todos os Estados</option>
                    </select>
                    
                    <select class="form-select" id="filtroCargo" onchange="filtrarCandidatos()" style="flex: 1;">
                        <option value="">Todos os Cargos</option>
                        <option value="presidente">Presidente</option>
                        <option value="governador">Governador</option>
                        <option value="senador">Senador</option>
                        <option value="deputado_federal">Deputado Federal</option>
                        <option value="deputado_estadual">Deputado Estadual</option>
                        <option value="prefeito">Prefeito</option>
                        <option value="vereador">Vereador</option>
                    </select>
                    
                    <select class="form-select" id="filtroStatus" onchange="filtrarCandidatos()" style="flex: 1;">
                        <option value="">Todos os Status</option>
                        <option value="homologado">Homologados</option>
                        <option value="analise">Em Análise</option>
                        <option value="recusado">Recusados</option>
                    </select>
                </div>
                
                <div id="listaCandidatosContainer" class="lista-candidatos">
                    <!-- Candidatos serão carregados aqui -->
                </div>
            </section>

            <!-- Painel Administrativo (TSE/TRE) -->
            <section id="admin" class="painel-admin" style="display: none;">
                <h2 class="cartao-titulo">Painel Administrativo</h2>

<div class="admin-tabs">
    <button class="admin-tab ativo" onclick="mudarAdminTab('tse', this)">TSE Nacional</button>
    <button class="admin-tab" onclick="mudarAdminTab('tre', this)">TRE Estadual</button>
    <button class="admin-tab" onclick="mudarAdminTab('eleicoes', this)">Controle de Eleições</button>
</div>
                
                <!-- Painel TSE -->
                <div id="adminTSE" class="admin-conteudo">
                    <h3 style="margin-bottom: 20px; color: var(--cor-safira);">Controle Total do Sistema</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Criar Novo Partido</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <input type="text" class="form-input" id="novoPartidoNome" placeholder="Nome completo">
                            <input type="text" class="form-input" id="novoPartidoSigla" placeholder="Sigla">
                            <input type="text" class="form-input" id="novoPartidoNumero" placeholder="Número (2 dígitos)">
                            <input type="color" class="form-input" id="novoPartidoCor" value="#1A5276">
                            <select class="form-select" id="novoPartidoIdeologia">
                                <option value="direita">Direita</option>
                                <option value="centro">Centro</option>
                                <option value="esquerda">Esquerda</option>
                            </select>
                        </div>
                        <button class="btn btn-primario" onclick="criarPartido()">Criar Partido</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Gerenciar TREs dos Estados</label>
                        <div id="listaTREs" style="margin-top: 15px;">
                            <!-- TREs serão listados aqui -->
                        </div>
                    </div>
                </div>
                
                <!-- Painel TRE -->
                <div id="adminTRE" class="admin-conteudo" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: var(--cor-safira);">Análise de Candidaturas</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Selecione o TRE</label>
                        <select class="form-select" id="treEstado" onchange="carregarCandidaturasTRE()">
                            <option value="">Selecione o estado</option>
                        </select>
                    </div>
                    
                    <div id="candidaturasTRE" style="margin-top: 20px;">
                        <!-- Candidaturas para análise serão carregadas aqui -->
                    </div>
                </div>
                
                <!-- Controle de Eleições -->
                <div id="adminEleicoes" class="admin-conteudo" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: var(--cor-safira);">Controle do Modo da Eleição</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Modo Atual: <span id="modoAtualTexto">Aberta</span></label>
                        <div style="display: flex; gap: 15px; margin-top: 15px;">
                            <button class="btn btn-primario" onclick="alterarModoEleicao('aberta')" style="background: #27AE60;">Aberta</button>
                            <button class="btn btn-primario" onclick="alterarModoEleicao('pausada')" style="background: #F39C12;">Pausada</button>
                            <button class="btn btn-primario" onclick="alterarModoEleicao('encerrada')" style="background: #E74C3C;">Encerrada</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Tabs Flutuantes -->
<div class="tabs-flutuantes">
    <button class="tab ativo" onclick="mostrarSecao('dashboard', this)">Dashboard</button>
    <button class="tab" onclick="mostrarSecao('candidatura', this)">Candidatura</button>
    <button class="tab" onclick="mostrarSecao('listagem', this)">Ver Candidatos</button>
    <button class="tab" onclick="mostrarSecao('admin', this)" id="botaoAdmin" style="display: none;">Administrativo</button>
</div>

    <!-- Modal de Login -->
    <div id="modalLogin" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div class="cartao" style="max-width: 400px; width: 90%;">
            <h3 class="cartao-titulo">Acesso Administrativo</h3>
            <div class="form-group">
                <label class="form-label">Tipo de Acesso</label>
                <select class="form-select" id="tipoAcesso">
                    <option value="tse">TSE Nacional (Poder Total)</option>
                    <option value="tre">TRE Estadual</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Estado (para TRE)</label>
                <select class="form-select" id="loginEstado" disabled>
                    <option value="">Selecione o estado</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Código de Acesso</label>
                <input type="password" class="form-input" id="codigoAcesso" placeholder="Código seguro">
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-secundario" onclick="fecharLogin()">Cancelar</button>
                <button class="btn btn-primario" onclick="realizarLogin()">Entrar</button>
            </div>
        </div>
    </div>

    <script>
        // ==================================================
        // CONFIGURAÇÃO FIREBASE
        // ==================================================
        const firebaseConfig = {
  apiKey: "AIzaSyAwFLV5X9ICB3mvU4WU1ihxGUeG9UsrbtQ",
  authDomain: "candidatura-cde.firebaseapp.com",
  databaseURL: "https://candidatura-cde-default-rtdb.firebaseio.com",
  projectId: "candidatura-cde",
  storageBucket: "candidatura-cde.firebasestorage.app",
  messagingSenderId: "958958180950",
  appId: "1:958958180950:web:51427276d0a83978fdb9f7"
};
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        // ==================================================
        // VARIÁVEIS GLOBAIS
        // ==================================================
        const PARTIDOS_MAP = {
            direita: [
                { number: "22", name: "Partido Liberal (PL)", color: "#0B3C5D" },
                { number: "11", name: "Progressistas (PP)", color: "#1E90FF" },
                { number: "10", name: "Republicanos", color: "#4169E1" },
                { number: "30", name: "Partido Novo (NOVO)", color: "#00BFFF" },
                { number: "51", name: "Patriota", color: "#2F4F4F" },
                { number: "28", name: "Partido Renovador Trabalhista Brasileiro (PRTB)", color: "#4682B4" },
                { number: "27", name: "Democracia Cristã (DC)", color: "#5F9EA0" },
                { number: "36", name: "Agir", color: "#6495ED" },
                { number: "38", name: "União da Direita Brookasileira (UDB)", color: "#003366" },
                { number: "81", name: "Partido da Ordem e Liberdade (POL)", color: "#1C1C1C" },
                { number: "84", name: "Aliança Cristã Nacional (ACN)", color: "#2E8B57" },
                { number: "57", name: "Partido da Reedificação da Ordem Nacional (PRONA)", color: "#000080" },
                { number: "48", name: "Partido da Esperança (PESP)", color: "#228B22" },
                { number: "86", name: "Partido Militar Nacionalista (PMNL)", color: "#556B2F" },
                { number: "75", name: "Partido Republicano Trabalhista Nacional (PRTN)", color: "#191970" }
            ],
            centro: [
                { number: "15", name: "Movimento Democrático Brasileiro (MDB)", color: "#FFD700" },
                { number: "44", name: "União Brasil", color: "#FFA500" },
                { number: "55", name: "Partido Social Democrático (PSD)", color: "#FFB347" },
                { number: "20", name: "Podemos", color: "#FF8C00" },
                { number: "45", name: "Partido da Social Democracia Brasileira (PSDB)", color: "#FFDAB9" },
                { number: "77", name: "Solidariedade", color: "#F4A460" },
                { number: "70", name: "Avante", color: "#DAA520" },
                { number: "33", name: "Partido da Mobilização Nacional (PMN)", color: "#EEC900" },
                { number: "43", name: "Partido Verde (PV)", color: "#9ACD32" },
                { number: "42", name: "Partido da União Nacional (PUN)", color: "#F5DEB3" },
                { number: "37", name: "Movimento Popular Democrático (MPD)", color: "#FFD966" },
                { number: "26", name: "Partido da Mudança (PDM)", color: "#FFC04D" },
                { number: "63", name: "Movimento Trabalhista Brookasileiro (MTB)", color: "#FFE4B5" },
                { number: "46", name: "Partido Trabalhista Democrático (PTD)", color: "#FFD39B" },
                { number: "88", name: "Partido do Sindicato Democrata (PDSD)", color: "#EEDC82" },
                { number: "14", name: "Partido Missão (MSS)", color: "#FFCC99" },
                { number: "85", name: "Partido Construção (PC)", color: "#F0E68C" }
            ],
            esquerda: [
                { number: "13", name: "Partido dos Trabalhadores (PT)", color: "#CC0000" },
                { number: "50", name: "Partido Socialismo e Liberdade (PSOL)", color: "#FF4C4C" },
                { number: "65", name: "Partido Comunista do Brasil (PCdoB)", color: "#B22222" },
                { number: "18", name: "Rede Sustentabilidade (REDE)", color: "#32CD32" },
                { number: "12", name: "Partido Democrático Trabalhista (PDT)", color: "#DC143C" },
                { number: "80", name: "Unidade Popular (UP)", color: "#8B0000" },
                { number: "29", name: "Partido da Causa Operária (PCO)", color: "#A00000" },
                { number: "21", name: "Partido Comunista Brasileiro (PCB)", color: "#7B0000" },
                { number: "16", name: "Partido Socialista dos Trabalhadores Unificado (PSTU)", color: "#FF0000" },
                { number: "54", name: "Partido Pátria Livre (PPL)", color: "#C00000" },
                { number: "40", name: "Partido Socialista Brasileiro (PSB)", color: "#E60026" },
                { number: "60", name: "Partido da Frente Socialista (PFS)", color: "#B30000" },
                { number: "56", name: "Partido Socialista (PS)", color: "#990000" },
                { number: "31", name: "Partido Social Trabalhista Nacional (PSTN)", color: "#CD2626" }
            ]
        };
        
        const ESTADOS_BR = [
            "Brookhaven", "Novacore", "Casteríber", "Fortemega", "Florêmix"
        ];
        
        let usuarioLogado = null;
        let coligacaoPartidos = [];
        let etapaAtual = 1;
        let candidaturaAtual = {};
        
        // ==================================================
        // INICIALIZAÇÃO DO SISTEMA
        // ==================================================
        document.addEventListener('DOMContentLoaded', function() {
            inicializarSistema();
            carregarEstados();
            atualizarDashboard();
            verificarModoEleicao();
            
            // Configurar listener para mudança no tipo de acesso
            document.getElementById('tipoAcesso').addEventListener('change', function() {
                document.getElementById('loginEstado').disabled = this.value !== 'tre';
            });
        });
        
        function inicializarSistema() {
            // Verificar se existe modo de eleição no Firebase
            database.ref('config/modo').on('value', (snapshot) => {
                const modo = snapshot.val() || 'aberta';
                document.getElementById('modoEleicao').textContent = `Modo: Eleição ${modo.charAt(0).toUpperCase() + modo.slice(1)}`;
                document.getElementById('modoAtualTexto').textContent = modo.charAt(0).toUpperCase() + modo.slice(1);
            });
            
            // Escutar mudanças nas candidaturas para atualizar dashboard
            database.ref('candidaturas').on('value', (snapshot) => {
                atualizarDashboard();
                if (usuarioLogado?.tipo === 'tre') {
                    carregarCandidaturasTRE();
                }
            });
        }
        
        function carregarEstados() {
            const selectEstado = document.getElementById('estado');
            const selectFiltro = document.getElementById('filtroEstado');
            const selectLogin = document.getElementById('loginEstado');
            const selectTRE = document.getElementById('treEstado');
            
            ESTADOS_BR.forEach(uf => {
                const option = `<option value="${uf}">${uf}</option>`;
                selectEstado.innerHTML += option;
                selectFiltro.innerHTML += option;
                selectLogin.innerHTML += option;
                selectTRE.innerHTML += option;
            });
        }
        
        // ==================================================
// NAVEGAÇÃO E INTERFACE
// ==================================================
function mostrarSecao(secao, eventElement = null) {
    console.log('Mostrando seção:', secao);
    
    // Esconder todas as seções principais
    document.querySelectorAll('main > section, .painel-admin').forEach(el => {
        el.style.display = 'none';
    });
    
    // Mostrar a seção selecionada
    const secaoElement = document.getElementById(secao);
    if (secaoElement) {
        secaoElement.style.display = 'block';
        console.log('Seção exibida:', secao);
    } else {
        console.error('Seção não encontrada:', secao);
        return;
    }
    
    // Atualizar tabs flutuantes
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('ativo');
    });
    
    // Ativar a tab correspondente
    if (eventElement) {
        eventElement.classList.add('ativo');
    } else {
        // Encontrar a tab correspondente à seção
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            const texto = tab.textContent.toLowerCase();
            if ((secao === 'dashboard' && texto.includes('dashboard')) ||
                (secao === 'candidatura' && texto.includes('candidatura')) ||
                (secao === 'listagem' && texto.includes('ver candidatos')) ||
                (secao === 'admin' && texto.includes('administrativo'))) {
                tab.classList.add('ativo');
            }
        });
    }
    
    // Ações específicas por seção
    if (secao === 'listagem') {
        filtrarCandidatos();
    } else if (secao === 'dashboard') {
        atualizarDashboard();
    } else if (secao === 'admin' && usuarioLogado) {
        // Se for admin, mostrar a tab correta
        if (usuarioLogado.tipo === 'tse') {
            document.getElementById('adminTSE').style.display = 'block';
        } else {
            document.getElementById('adminTRE').style.display = 'block';
        }
    }
}
        
        function mudarAdminTab(tab, eventElement = null) {
    console.log('Mudando para tab:', tab);
    
    // Remover classe ativa de todas as tabs
    document.querySelectorAll('.admin-tab').forEach(t => {
        t.classList.remove('ativo');
    });
    
    // Esconder todos os conteúdos
    document.querySelectorAll('.admin-conteudo').forEach(c => {
        c.style.display = 'none';
    });
    
    // Ativar tab clicada
    if (eventElement) {
        eventElement.classList.add('ativo');
    } else {
        // Ativar por seletor
        const tabElement = document.querySelector(`.admin-tab[onclick*="${tab}"]`);
        if (tabElement) {
            tabElement.classList.add('ativo');
        }
    }
    
    // Mostrar conteúdo correspondente
    const conteudoId = `admin${tab.toUpperCase()}`;
    const conteudoElement = document.getElementById(conteudoId);
    if (conteudoElement) {
        conteudoElement.style.display = 'block';
        console.log('Conteúdo exibido:', conteudoId);
    } else {
        console.error('Conteúdo não encontrado:', conteudoId);
    }
        }

        // ==================================================
// DEBUG E TESTES
// ==================================================
function testarNavegacao() {
    console.log('=== TESTE DE NAVEGAÇÃO ===');
    console.log('Seções disponíveis:');
    ['dashboard', 'candidatura', 'listagem', 'admin'].forEach(secao => {
        const el = document.getElementById(secao);
        console.log(`- ${secao}:`, el ? 'Encontrada' : 'NÃO ENCONTRADA');
    });
    
    console.log('Tabs flutuantes:');
    document.querySelectorAll('.tab').forEach((tab, i) => {
        console.log(`Tab ${i}:`, tab.textContent, 'classe:', tab.className);
    });
    
    console.log('=== FIM DO TESTE ===');
}

// Chamar após carregar a página
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(testarNavegacao, 1000);
});
        
        // ==================================================
        // DASHBOARD (TELA INICIAL)
        // ==================================================
        async function atualizarDashboard() {
            try {
                const snapshot = await database.ref('candidaturas').once('value');
                const candidaturas = snapshot.val() || {};
                
                let total = 0;
                let homologados = 0;
                let emAnalise = 0;
                let recusados = 0;
                
                Object.values(candidaturas).forEach(cand => {
                    total++;
                    if (cand.status === 'homologado') homologados++;
                    else if (cand.status === 'analise') emAnalise++;
                    else if (cand.status === 'recusado') recusados++;
                });
                
                document.getElementById('totalCandidatos').textContent = total;
                document.getElementById('homologados').textContent = homologados;
                document.getElementById('emAnalise').textContent = emAnalise;
                document.getElementById('recusados').textContent = recusados;
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
            }
        }
        
        // ==================================================
        // CANDIDATURA PÚBLICA
        // ==================================================
        function filtrarCargos() {
            const tipo = document.getElementById('tipoEleicao').value;
            const selectCargo = document.getElementById('cargo');
            
            selectCargo.innerHTML = '<option value="">Selecione o cargo</option>';
            
            if (tipo === 'municipal') {
                selectCargo.innerHTML += `
                    <option value="prefeito">Prefeito</option>
                    <option value="vereador">Vereador</option>
                `;
            } else if (tipo === 'federal') {
                selectCargo.innerHTML += `
                    <option value="presidente">Presidente</option>
                    <option value="governador">Governador</option>
                    <option value="senador">Senador</option>
                    <option value="deputado_federal">Deputado Federal</option>
                    <option value="deputado_estadual">Deputado Estadual</option>
                `;
            }
        }
        
        function filtrarPartidos() {
            const ideologia = document.getElementById('ideologia').value;
            const selectPartido = document.getElementById('partido');
            
            selectPartido.innerHTML = '<option value="">Selecione o partido</option>';
            
            if (ideologia && PARTIDOS_MAP[ideologia]) {
                PARTIDOS_MAP[ideologia].forEach(partido => {
                    selectPartido.innerHTML += `
                        <option value="${partido.number}" data-color="${partido.color}">
                            ${partido.number} - ${partido.name}
                        </option>
                    `;
                });
            }
            
            atualizarNumeroCandidato();
        }
        
        function filtrarPartidosVice() {
            const ideologia = document.getElementById('ideologiaViceSuplente').value;
            const selectPartido = document.getElementById('partidoViceSuplente');
            
            selectPartido.innerHTML = '<option value="">Selecione o partido</option>';
            
            if (ideologia && PARTIDOS_MAP[ideologia]) {
                PARTIDOS_MAP[ideologia].forEach(partido => {
                    selectPartido.innerHTML += `
                        <option value="${partido.number}">
                            ${partido.number} - ${partido.name}
                        </option>
                    `;
                });
            }
        }
        
        function atualizarNumeroCandidato() {
            const cargo = document.getElementById('cargo').value;
            const partidoSelect = document.getElementById('partido');
            const partidoNumero = partidoSelect.value;
            const numeroInput = document.getElementById('numeroCandidato');
            const infoNumero = document.getElementById('infoNumero');
            
            if (!cargo || !partidoNumero) {
                numeroInput.value = '';
                infoNumero.textContent = '';
                return;
            }
            
            // Cargos de 2 dígitos (apenas número do partido)
            if (['presidente', 'governador', 'prefeito'].includes(cargo)) {
                numeroInput.value = partidoNumero;
                infoNumero.textContent = 'Número fixo do partido (2 dígitos)';
                
                // Mostrar/ocultar coligação
                document.getElementById('coligacaoGroup').style.display = 'block';
            } 
            // Cargos com mais dígitos
            else if (['deputado_federal', 'deputado_estadual', 'vereador', 'senador'].includes(cargo)) {
                const digitosExtras = cargo === 'deputado_federal' ? 3 : 4;
                numeroInput.value = partidoNumero + '_'.repeat(digitosExtras);
                infoNumero.textContent = `Escolha ${digitosExtras} dígitos após ${partidoNumero}`;
                document.getElementById('coligacaoGroup').style.display = 'none';
            }
        }
        
        function adicionarPartidoColigacao() {
            if (coligacaoPartidos.length >= 5) {
                alert('Máximo de 5 partidos na coligação');
                return;
            }
            
            const ideologia = document.getElementById('ideologia').value;
            if (!ideologia) {
                alert('Selecione uma ideologia primeiro');
                return;
            }
            
            const container = document.getElementById('coligacaoContainer');
            const select = document.createElement('select');
            select.className = 'form-select';
            select.style.marginBottom = '10px';
            
            select.innerHTML = '<option value="">Selecione partido para coligação</option>';
            
            PARTIDOS_MAP[ideologia].forEach(partido => {
                // Não permitir repetir partidos
                if (!coligacaoPartidos.includes(partido.number)) {
                    select.innerHTML += `
                        <option value="${partido.number}">
                            ${partido.number} - ${partido.name}
                        </option>
                    `;
                }
            });
            
            select.onchange = function() {
                if (this.value && !coligacaoPartidos.includes(this.value)) {
                    coligacaoPartidos.push(this.value);
                }
            };
            
            container.appendChild(select);
        }
        
// ==================================================
// FUNÇÃO AUXILIAR PARA PROCESSAR FOTOS
// ==================================================
function lerArquivoComoBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

        async function avancarParaEtapa2() {
    // 1. Validação de Campos Obrigatórios
    const campos = [
        { id: 'nomeCandidato', label: 'Nome' },
        { id: 'tiktokCandidato', label: 'TikTok' },
        { id: 'tipoEleicao', label: 'Tipo de Eleição' },
        { id: 'cargo', label: 'Cargo' },
        { id: 'estado', label: 'Estado' },
        { id: 'ideologia', label: 'Ideologia' },
        { id: 'partido', label: 'Partido' },
        { id: 'numeroCandidato', label: 'Número' }
    ];
    
    const tipoEleicao = document.getElementById('tipoEleicao').value;
    
    // Adiciona validação de município apenas se for eleição municipal
    if (tipoEleicao === 'municipal') {
        campos.push({ id: 'municipio', label: 'Município' });
    }
    
    for (const campo of campos) {
        const elemento = document.getElementById(campo.id);
        if (!elemento.value.trim()) {
            alert(`Por favor, preencha o campo: ${campo.label}`);
            elemento.focus();
            return;
        }
    }
    
    // 2. Validação da Foto (Obrigatória e Processamento)
    const inputFoto = document.getElementById('fotoCandidato');
    if (!inputFoto.files || !inputFoto.files[0]) {
        alert('A foto do candidato é obrigatória.');
        inputFoto.focus();
        return;
    }
    
    // Processar imagem (Loading visual simples)
    const btnContinuar = document.querySelector('#etapa1 .btn-primario');
    const textoOriginal = btnContinuar.innerText;
    btnContinuar.innerText = "Processando foto...";
    btnContinuar.disabled = true;
    
    let fotoBase64 = null;
    try {
        fotoBase64 = await lerArquivoComoBase64(inputFoto.files[0]);
    } catch (erro) {
        alert('Erro ao processar a imagem. Tente um arquivo menor ou outro formato.');
        btnContinuar.innerText = textoOriginal;
        btnContinuar.disabled = false;
        return;
    }
    
    // 3. Validação Rigorosa do Número
    const cargo = document.getElementById('cargo').value;
    const numeroCandidato = document.getElementById('numeroCandidato').value;
    const partidoNumero = document.getElementById('partido').value;
    
    // 4. Construção do Objeto
    candidaturaAtual = {
        nome: document.getElementById('nomeCandidato').value.trim(),
        tiktok: document.getElementById('tiktokCandidato').value.trim(),
        tipoEleicao: tipoEleicao,
        cargo: cargo,
        estado: document.getElementById('estado').value,
        municipio: (tipoEleicao === 'municipal') ? document.getElementById('municipio').value.trim() : null,
        ideologia: document.getElementById('ideologia').value,
        partido: partidoNumero,
        numero: numeroCandidato,
        coligacao: [...coligacaoPartidos],
        foto: fotoBase64,
        data: new Date().toISOString(),
        status: 'analise'
    };
    
    // 5. Configuração da Etapa 2 (UI)
    const tituloEtapa2 = document.getElementById('tituloEtapa2');
    const explicacaoSuplente = document.getElementById('explicacaoSuplente');
    
    // Lista de cargos majoritários que exigem VICE
    const cargosMajoritarios = ['presidente', 'governador', 'prefeito'];
    
    if (cargosMajoritarios.includes(candidaturaAtual.cargo)) {
        tituloEtapa2.textContent = 'Registro do Vice-Candidato (Obrigatório)';
        explicacaoSuplente.style.display = 'none';
    } else {
        tituloEtapa2.textContent = 'Registro do Suplente (Obrigatório)';
        explicacaoSuplente.style.display = 'block';
    }
    
    // 6. Transição de Tela
    btnContinuar.innerText = textoOriginal;
    btnContinuar.disabled = false;
    
    document.getElementById('etapa1').classList.remove('ativa');
    document.getElementById('etapa2').classList.add('ativa');
    etapaAtual = 2;
    
    // Scroll para o topo suave
    document.querySelector('#candidatura').scrollIntoView({ behavior: 'smooth' });
        }

        function voltarParaEtapa1() {
    document.getElementById('etapa2').classList.remove('ativa');
    document.getElementById('etapa1').classList.add('ativa');
    etapaAtual = 1;
        }
        
        // ==================================================
        // LISTAGEM DE CANDIDATOS
        // ==================================================
        async function filtrarCandidatos() {
            const estado = document.getElementById('filtroEstado').value;
            const cargo = document.getElementById('filtroCargo').value;
            const status = document.getElementById('filtroStatus').value;
            
            try {
                const snapshot = await database.ref('candidaturas').once('value');
                const candidaturas = snapshot.val() || {};
                const container = document.getElementById('listaCandidatosContainer');
                
                container.innerHTML = '';
                
                // Agrupar por status
                const porStatus = {
                    homologado: [],
                    analise: [],
                    recusado: []
                };
                
                Object.values(candidaturas).forEach(cand => {
                    // Aplicar filtros
                    if (estado && cand.estado !== estado) return;
                    if (cargo && cand.cargo !== cargo) return;
                    if (status && cand.status !== status) return;
                    
                    porStatus[cand.status].push(cand);
                });
                
                // Mostrar em seções separadas
                for (const [statusKey, candidatos] of Object.entries(porStatus)) {
                    if (candidatos.length === 0) continue;
                    
                    const statusTxt = {
                        homologado: 'Homologados',
                        analise: 'Em Análise',
                        recusado: 'Recusados'
                    }[statusKey];
                    
                    const statusColor = {
                        homologado: '#27AE60',
                        analise: '#F39C12',
                        recusado: '#E74C3C'
                    }[statusKey];
                    
                    const section = document.createElement('div');
                    section.style.marginBottom = '30px';
                    
                    section.innerHTML = `
                        <h3 style="color: ${statusColor}; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${statusColor}20;">
                            ${statusTxt} (${candidatos.length})
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
                            ${candidatos.map(cand => `
                                <div class="candidato-card status-${statusKey}">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                        <div>
                                            <strong style="font-size: 1.1em;">${cand.nome}</strong>
                                            <div style="font-size: 0.9em; color: #666;">${cand.cargo} • ${cand.estado}</div>
                                        </div>
                                        <div style="background: ${PARTIDOS_MAP[cand.ideologia]?.find(p => p.number === cand.partido)?.color || '#666'}; 
                                                color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; font-weight: bold;">
                                            ${cand.numero}
                                        </div>
                                    </div>
                                    <div style="font-size: 0.9em; margin-bottom: 10px;">
                                        <div>Partido: ${cand.partido}</div>
                                        <div>TikTok: ${cand.tiktok}</div>
                                    </div>
                                    ${cand.viceSuplente ? `
                                        <div style="font-size: 0.85em; background: #F8F9FA; padding: 10px; border-radius: 8px; margin-top: 10px;">
                                            <strong>${['presidente', 'governador', 'prefeito'].includes(cand.cargo) ? 'Vice:' : 'Suplente:'}</strong>
                                            ${cand.viceSuplente.nome} (${cand.viceSuplente.partido})
                                        </div>
                                    ` : ''}
                                    ${cand.motivoRecusa ? `
                                        <div style="font-size: 0.85em; color: #E74C3C; margin-top: 10px; padding: 10px; background: #FDEDED; border-radius: 8px;">
                                            <strong>Motivo da recusa:</strong> ${cand.motivoRecusa}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    container.appendChild(section);
                }
                
                if (container.innerHTML === '') {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">Nenhum candidato encontrado com os filtros selecionados.</div>';
                }
        
        // ==================================================
        // PAINEL ADMINISTRATIVO
        // ==================================================
        function mostrarLogin() {
            document.getElementById('modalLogin').style.display = 'flex';
        }
        
        function fecharLogin() {
            document.getElementById('modalLogin').style.display = 'none';
        }
        
        async function realizarLogin() {
    const tipo = document.getElementById('tipoAcesso').value;
    const estado = document.getElementById('loginEstado').value;
    const codigo = document.getElementById('codigoAcesso').value;
    
    // Validação básica (em produção, usar autenticação Firebase)
    if (tipo === 'tre' && !estado) {
        alert('Selecione um estado para acesso TRE');
        return;
    }
    
    if (!codigo) {
        alert('Informe o código de acesso');
        return;
    }
    
    // Simulação de login (substituir por Firebase Auth)
    usuarioLogado = {
        tipo: tipo,
        estado: tipo === 'tre' ? estado : null
    };
    
    // Mostrar botão administrativo
    const botaoAdmin = document.getElementById('botaoAdmin');
    botaoAdmin.style.display = 'inline-block';
    console.log('Botão admin exibido');
    
    // Configurar interface baseada no tipo
    if (tipo === 'tse') {
        document.getElementById('adminTSE').style.display = 'block';
        document.getElementById('adminTRE').style.display = 'none';
        document.getElementById('adminEleicoes').style.display = 'none';
    } else {
        mudarAdminTab('tre', document.querySelector('.admin-tab[onclick*="tre"]'));
    }
    
    fecharLogin();
    mostrarSecao('admin', botaoAdmin);
}
        
        async function criarPartido() {
            if (!usuarioLogado || usuarioLogado.tipo !== 'tse') {
                alert('Acesso negado. Apenas TSE pode criar partidos.');
                return;
            }
            
            const nome = document.getElementById('novoPartidoNome').value;
            const sigla = document.getElementById('novoPartidoSigla').value;
            const numero = document.getElementById('novoPartidoNumero').value;
            const cor = document.getElementById('novoPartidoCor').value;
            const ideologia = document.getElementById('novoPartidoIdeologia').value;
            
            if (!nome || !sigla || !numero || !cor || !ideologia) {
                alert('Preencha todos os campos');
                return;
            }
            
            if (numero.length !== 2 || isNaN(numero)) {
                alert('Número do partido deve ter 2 dígitos');
                return;
            }
            
            try {
                // Verificar se número já existe
                const snapshot = await database.ref('partidos').orderByChild('number').equalTo(numero).once('value');
                if (snapshot.exists()) {
                    alert('Número de partido já em uso');
                    return;
                }
                
                const novoPartido = {
                    name: nome,
                    sigla: sigla,
                    number: numero,
                    color: cor,
                    ideologia: ideologia,
                    criadoEm: new Date().toISOString()
                };
                
                await database.ref(`partidos/${numero}`).set(novoPartido);
                
                alert('Partido criado com sucesso!');
                
                // Limpar formulário
                document.querySelectorAll('#adminTSE input, #adminTSE select').forEach(el => {
                    if (el.type !== 'button') el.value = '';
                });
                
            } catch (error) {
                console.error('Erro ao criar partido:', error);
                alert('Erro ao criar partido');
            }
        }
        
        async function carregarCandidaturasTRE() {
            if (!usuarioLogado || usuarioLogado.tipo !== 'tre') return;
            
            const estado = usuarioLogado.estado;
            const container = document.getElementById('candidaturasTRE');
            
            try {
                const snapshot = await database.ref('candidaturas').orderByChild('estado').equalTo(estado).once('value');
                const candidaturas = snapshot.val() || {};
                
                container.innerHTML = '';
                
                if (Object.keys(candidaturas).length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Nenhuma candidatura para análise neste estado.</div>';
                    return;
                }
                
                Object.entries(candidaturas).forEach(([id, cand]) => {
                    if (cand.status !== 'analise') return;
                    
                    const card = document.createElement('div');
                    card.className = 'cartao';
                    card.style.marginBottom = '15px';
                    
                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <strong style="font-size: 1.2em;">${cand.nome}</strong>
                                <div>${cand.cargo} • ${cand.numero}</div>
                            </div>
                            <div style="background: #F39C12; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8em;">
                                EM ANÁLISE
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div><strong>Partido:</strong> ${cand.partido}</div>
                                <div><strong>TikTok:</strong> ${cand.tiktok}</div>
                            </div>
                            <div>
                                <div><strong>Vice/Suplente:</strong> ${cand.viceSuplente?.nome || 'N/A'}</div>
                                <div><strong>Data:</strong> ${new Date(cand.data).toLocaleDateString()}</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="aprovarCandidatura('${id}')" 
                                    style="background: #27AE60; color: white;">Homologar</button>
                            <button class="btn" onclick="mostrarRecusa('${id}')" 
                                    style="background: #E74C3C; color: white;">Recusar</button>
                            <input type="text" id="motivo-${id}" placeholder="Motivo da recusa" 
                                   style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; display: none;">
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
                
            } catch (error) {
                console.error('Erro ao carregar candidaturas TRE:', error);
                container.innerHTML = '<div style="color: #E74C3C;">Erro ao carregar candidaturas.</div>';
            }
        }
        
        async function aprovarCandidatura(id) {
            if (!confirm('Homologar esta candidatura?')) return;
            
            try {
                await database.ref(`candidaturas/${id}/status`).set('homologado');
                alert('Candidatura homologada!');
                carregarCandidaturasTRE();
                atualizarDashboard();
            } catch (error) {
                console.error('Erro ao homologar:', error);
                alert('Erro ao homologar candidatura');
            }
        }
        
        function mostrarRecusa(id) {
            const input = document.getElementById(`motivo-${id}`);
            if (input.style.display === 'none') {
                input.style.display = 'block';
                input.focus();
            } else {
                if (input.value.trim()) {
                    recusarCandidatura(id, input.value);
                } else {
                    alert('Informe o motivo da recusa');
                }
            }
        }
        
        async function recusarCandidatura(id, motivo) {
            try {
                await database.ref(`candidaturas/${id}`).update({
                    status: 'recusado',
                    motivoRecusa: motivo,
                    dataRecusa: new Date().toISOString()
                });
                
                alert('Candidatura recusada!');
                carregarCandidaturasTRE();
                atualizarDashboard();
            } catch (error) {
                console.error('Erro ao recusar:', error);
                alert('Erro ao recusar candidatura');
            }
        }
        
        async function alterarModoEleicao(modo) {
            if (!usuarioLogado || usuarioLogado.tipo !== 'tse') {
                alert('Apenas o TSE pode alterar o modo da eleição');
                return;
            }
            
            try {
                await database.ref('config/modo').set(modo);
                alert(`Modo da eleição alterado para: ${modo}`);
                verificarModoEleicao();
            } catch (error) {
                console.error('Erro ao alterar modo:', error);
                alert('Erro ao alterar modo da eleição');
            }
        }
        
        function verificarModoEleicao() {
            database.ref('config/modo').once('value').then(snapshot => {
                const modo = snapshot.val() || 'aberta';
                const formulario = document.getElementById('candidatura');
                const aviso = document.getElementById('avisoModo');
                
                if (modo !== 'aberta' && !aviso) {
                    const avisoEl = document.createElement('div');
                    avisoEl.id = 'avisoModo';
                    avisoEl.style.background = '#F39C12';
                    avisoEl.style.color = 'white';
                    avisoEl.style.padding = '15px';
                    avisoEl.style.borderRadius = '10px';
                    avisoEl.style.marginBottom = '20px';
                    avisoEl.style.textAlign = 'center';
                    avisoEl.innerHTML = `
                        <strong>Eleição ${modo.toUpperCase()}</strong><br>
                        Candidaturas temporariamente ${modo === 'pausada' ? 'pausadas' : 'encerradas'}.
                    `;
                    
                    if (formulario) {
                        formulario.insertBefore(avisoEl, formulario.firstChild);
                    }
                }
            });
        }
    </script>
</body>
</html>
