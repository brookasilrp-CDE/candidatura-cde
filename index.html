<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSE Brookasil - Sistema Eleitoral Nacional 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
/* ============================================
   VARIÁVEIS DE CORES CYBERPUNK
   ============================================ */
:root {
    --primary-gradient: linear-gradient(135deg, #00ffcc 0%, #00ccff 50%, #9933ff 100%);
    --secondary-gradient: linear-gradient(135deg, #ff3366 0%, #ff9933 100%);
    --dark-bg: #0a0a1a;
    --darker-bg: #050510;
    --card-bg: rgba(10, 15, 35, 0.8);
    --glass-bg: rgba(255, 255, 255, 0.05);
    --glass-border: rgba(255, 255, 255, 0.1);
    --neon-blue: #00f3ff;
    --neon-purple: #bf00ff;
    --neon-pink: #ff00cc;
    --neon-green: #00ff9d;
    --text-primary: #ffffff;
    --text-secondary: #b8b8d1;
    --success: #00ff88;
    --warning: #ffaa00;
    --danger: #ff5555;
    --grid-color: rgba(0, 243, 255, 0.1);
    --hologram-color: rgba(191, 0, 255, 0.15);
}

/* ============================================
   RESET E CONFIGURAÇÕES GERAIS
   ============================================ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
}

body {
    background: 
        radial-gradient(ellipse at 20% 20%, rgba(0, 243, 255, 0.1) 0%, transparent 40%),
        radial-gradient(ellipse at 80% 80%, rgba(191, 0, 255, 0.1) 0%, transparent 40%),
        linear-gradient(180deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
    color: var(--text-primary);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
}

/* Grid holográfico de fundo */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(90deg, var(--grid-color) 1px, transparent 1px),
        linear-gradient(0deg, var(--grid-color) 1px, transparent 1px);
    background-size: 50px 50px;
    pointer-events: none;
    opacity: 0.3;
    z-index: 0;
}

/* Efeito de partículas animadas */
body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 30%, rgba(0, 243, 255, 0.1) 0%, transparent 10%),
        radial-gradient(circle at 80% 20%, rgba(191, 0, 255, 0.1) 0%, transparent 10%),
        radial-gradient(circle at 40% 80%, rgba(255, 0, 204, 0.1) 0%, transparent 10%);
    animation: particleFloat 20s infinite linear;
    pointer-events: none;
    z-index: 0;
}

@keyframes particleFloat {
    0% { transform: translate(0, 0) rotate(0deg); }
    100% { transform: translate(100px, 100px) rotate(360deg); }
}

.container {
    max-width: 1800px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
}

/* ============================================
   HEADER NEON COM EFEITO GLITCH
   ============================================ */
header {
    background: rgba(10, 15, 35, 0.7);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 25px;
    padding: 25px 40px;
    margin-bottom: 40px;
    box-shadow: 
        0 20px 50px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(0, 243, 255, 0.1),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    position: relative;
    overflow: hidden;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Efeito de glitch no header */
header::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: var(--primary-gradient);
    z-index: -1;
    filter: blur(20px);
    opacity: 0.3;
    animation: glitch 5s infinite;
}

@keyframes glitch {
    0%, 100% { opacity: 0.3; transform: translate(0, 0); }
    2% { opacity: 0.4; transform: translate(-2px, 2px); }
    4% { opacity: 0.3; transform: translate(2px, -2px); }
    96% { opacity: 0.3; transform: translate(0, 0); }
    98% { opacity: 0.4; transform: translate(2px, -2px); }
}

.logo-container {
    display: flex;
    align-items: center;
    gap: 25px;
}

.logo {
    width: 100px;
    height: 100px;
    background: var(--primary-gradient);
    border-radius: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    color: var(--dark-bg);
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 0 30px rgba(0, 243, 255, 0.5),
        inset 0 0 0 2px rgba(255, 255, 255, 0.2);
    animation: logoPulse 4s infinite;
}

@keyframes logoPulse {
    0%, 100% { 
        box-shadow: 
            0 0 30px rgba(0, 243, 255, 0.5),
            inset 0 0 0 2px rgba(255, 255, 255, 0.2);
    }
    50% { 
        box-shadow: 
            0 0 60px rgba(191, 0, 255, 0.7),
            inset 0 0 0 2px rgba(255, 255, 255, 0.3);
    }
}

.titulo-sistema h1 {
    font-size: 2.8rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 900;
    letter-spacing: -0.5px;
    margin-bottom: 8px;
    text-shadow: 0 0 30px rgba(0, 243, 255, 0.5);
    position: relative;
    display: inline-block;
}

.titulo-sistema h1::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--primary-gradient);
    border-radius: 3px;
    opacity: 0.7;
}

.titulo-sistema p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    font-weight: 300;
    letter-spacing: 1px;
}

.usuario-info {
    background: rgba(5, 10, 25, 0.7);
    padding: 20px 30px;
    border-radius: 20px;
    border: 1px solid rgba(0, 243, 255, 0.2);
    position: relative;
    overflow: hidden;
    text-align: right;
    min-width: 250px;
}

.usuario-info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--primary-gradient);
    animation: scanline 2s linear infinite;
}

@keyframes scanline {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
}

.usuario-nome {
    font-size: 1.4rem;
    font-weight: 700;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 5px;
}

.usuario-cargo {
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 300;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* ============================================
   ABAS HOLOGRÁFICAS
   ============================================ */
.abas-container {
    display: flex;
    background: rgba(10, 15, 35, 0.7);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    overflow: hidden;
    border: 1px solid var(--glass-border);
    box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.4),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    margin-bottom: 40px;
    position: relative;
}

.abas-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--primary-gradient);
    opacity: 0.5;
}

.abas-lateral {
    width: 280px;
    background: linear-gradient(
        180deg,
        rgba(5, 10, 25, 0.9) 0%,
        rgba(10, 15, 35, 0.9) 100%
    );
    padding: 40px 0;
    border-right: 1px solid var(--glass-border);
}

.aba-item {
    padding: 22px 35px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 18px;
    font-size: 1.1rem;
    font-weight: 500;
    position: relative;
    border-left: 4px solid transparent;
    margin: 5px 0;
}

.aba-item:hover {
    background: rgba(0, 243, 255, 0.1);
    color: var(--neon-blue);
    padding-left: 40px;
    border-left-color: var(--neon-blue);
}

.aba-item:hover::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 3px;
    background: var(--neon-blue);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

.aba-item.ativo {
    background: linear-gradient(
        90deg,
        rgba(0, 243, 255, 0.2) 0%,
        transparent 100%
    );
    color: var(--neon-blue);
    border-left-color: var(--neon-blue);
    font-weight: 700;
    text-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
}

.aba-item.ativo i {
    transform: scale(1.2);
    filter: drop-shadow(0 0 10px currentColor);
}

.aba-item i {
    width: 24px;
    text-align: center;
    font-size: 1.4rem;
    transition: all 0.3s ease;
}

.conteudo-abas {
    flex: 1;
    padding: 40px;
    min-height: 800px;
    background: rgba(5, 10, 25, 0.5);
}

.aba-conteudo {
    display: none;
    animation: hologramAppear 0.6s ease-out;
}

.aba-conteudo.ativo {
    display: block;
}

@keyframes hologramAppear {
    from {
        opacity: 0;
        transform: translateY(30px) perspective(1000px) rotateX(10deg);
        filter: blur(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0) perspective(1000px) rotateX(0);
        filter: blur(0);
    }
}

/* ============================================
   CARDS DE DASHBOARD NEON
   ============================================ */
.dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-bottom: 50px;
}

.card {
    background: rgba(10, 15, 35, 0.7);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 30px;
    border: 1px solid var(--glass-border);
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.2),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
}

.card:hover {
    transform: translateY(-15px) scale(1.02);
    border-color: var(--neon-blue);
    box-shadow: 
        0 30px 60px rgba(0, 0, 0, 0.4),
        0 0 100px rgba(0, 243, 255, 0.2),
        inset 0 0 0 1px rgba(0, 243, 255, 0.3);
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--primary-gradient);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.card:hover::before {
    opacity: 1;
}

.card-titulo {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.card-valor {
    font-size: 3.5rem;
    font-weight: 900;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 10px;
    line-height: 1;
    text-shadow: 0 0 30px rgba(0, 243, 255, 0.3);
}

.card-detalhe {
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 300;
    opacity: 0.8;
}

/* ============================================
   FILTROS GLASSMORPHISM
   ============================================ */
.filtros-container {
    background: rgba(10, 15, 35, 0.7);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    padding: 35px;
    border: 1px solid var(--glass-border);
    margin-bottom: 40px;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.3),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
}

.filtros-titulo {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.filtros-titulo i {
    color: var(--neon-blue);
    filter: drop-shadow(0 0 10px currentColor);
}

.filtros-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
}

.filtro-group {
    display: flex;
    flex-direction: column;
}

.filtro-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
}

.filtro-select, .form-select, .form-input {
    padding: 18px 20px;
    border-radius: 12px;
    border: 1px solid rgba(0, 243, 255, 0.3);
    background: rgba(5, 10, 25, 0.7);
    color: var(--text-primary);
    font-size: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 400;
    outline: none;
}

.filtro-select:focus, .form-select:focus, .form-input:focus {
    border-color: var(--neon-blue);
    box-shadow: 
        0 0 0 3px rgba(0, 243, 255, 0.1),
        0 0 30px rgba(0, 243, 255, 0.2);
    background: rgba(5, 10, 25, 0.9);
}

.filtro-select option, .form-select option {
    background: var(--dark-bg);
    color: var(--text-primary);
    padding: 12px;
}

/* ============================================
   TABELA HOLOGRÁFICA
   ============================================ */
.tabela-container {
    background: rgba(10, 15, 35, 0.7);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    overflow: hidden;
    border: 1px solid var(--glass-border);
    margin-bottom: 40px;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.3),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
}

.tabela-header {
    padding: 25px 35px;
    background: linear-gradient(
        90deg,
        rgba(0, 243, 255, 0.2) 0%,
        rgba(191, 0, 255, 0.2) 100%
    );
    border-bottom: 1px solid var(--glass-border);
    position: relative;
    overflow: hidden;
}

.tabela-header h3 {
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 15px;
    color: var(--text-primary);
}

.tabela-content {
    overflow-x: auto;
    max-height: 600px;
    position: relative;
}

.tabela-content::-webkit-scrollbar {
    height: 8px;
    width: 8px;
}

.tabela-content::-webkit-scrollbar-track {
    background: rgba(5, 10, 25, 0.5);
    border-radius: 4px;
}

.tabela-content::-webkit-scrollbar-thumb {
    background: var(--primary-gradient);
    border-radius: 4px;
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px;
}

thead {
    background: rgba(5, 10, 25, 0.9);
    position: sticky;
    top: 0;
    z-index: 10;
}

th {
    padding: 22px 20px;
    text-align: left;
    color: var(--neon-blue);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-size: 0.85rem;
    border-bottom: 2px solid rgba(0, 243, 255, 0.3);
    white-space: nowrap;
}

td {
    padding: 22px 20px;
    border-bottom: 1px solid rgba(0, 243, 255, 0.1);
    color: var(--text-primary);
    font-weight: 400;
}

tbody tr {
    transition: all 0.3s ease;
    position: relative;
}

tbody tr::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 3px;
    height: 100%;
    background: var(--primary-gradient);
    opacity: 0;
    transition: opacity 0.3s ease;
}

tbody tr:hover {
    background: rgba(0, 243, 255, 0.05);
}

tbody tr:hover::before {
    opacity: 1;
}

tbody tr:hover td {
    color: var(--neon-blue);
}

/* ============================================
   BADGES DE STATUS
   ============================================ */
.status-badge {
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    display: inline-block;
    letter-spacing: 1px;
    text-transform: uppercase;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
}

.status-badge::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        45deg,
        transparent 30%,
        rgba(255, 255, 255, 0.2) 50%,
        transparent 70%
    );
    animation: shine 3s infinite;
}

@keyframes shine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.status-analise { 
    background: linear-gradient(135deg, var(--warning), #ffcc00);
    color: var(--dark-bg);
    box-shadow: 0 0 20px rgba(255, 170, 0, 0.4);
}

.status-aprovado { 
    background: linear-gradient(135deg, var(--success), #00ffaa);
    color: var(--dark-bg);
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
}

.status-recusado { 
    background: linear-gradient(135deg, var(--danger), #ff3366);
    color: white;
    box-shadow: 0 0 20px rgba(255, 85, 85, 0.4);
}

/* ============================================
   BOTÕES NEON
   ============================================ */
.btn {
    padding: 18px 35px;
    border-radius: 15px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        inset 0 0 0 1px rgba(255, 255, 255, 0.1);
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
    );
    transition: left 0.6s ease;
}

.btn:hover::before {
    left: 100%;
}

.btn-primario {
    background: var(--primary-gradient);
    color: var(--dark-bg);
    box-shadow: 
        0 15px 35px rgba(0, 243, 255, 0.4),
        inset 0 0 0 1px rgba(255, 255, 255, 0.2);
}

.btn-primario:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
        0 25px 50px rgba(0, 243, 255, 0.6),
        0 0 100px rgba(0, 243, 255, 0.3),
        inset 0 0 0 1px rgba(255, 255, 255, 0.3);
    filter: brightness(1.2);
}

.btn-secundario {
    background: transparent;
    color: var(--neon-blue);
    border: 2px solid var(--neon-blue);
}

.btn-secundario:hover {
    background: rgba(0, 243, 255, 0.1);
    transform: translateY(-5px);
    box-shadow: 
        0 15px 35px rgba(0, 243, 255, 0.3),
        inset 0 0 0 1px rgba(0, 243, 255, 0.3);
}

.btn-terciario {
    background: var(--secondary-gradient);
    color: white;
    box-shadow: 
        0 15px 35px rgba(255, 51, 102, 0.4),
        inset 0 0 0 1px rgba(255, 255, 255, 0.2);
}

.btn-terciario:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
        0 25px 50px rgba(255, 51, 102, 0.6),
        0 0 100px rgba(255, 51, 102, 0.3),
        inset 0 0 0 1px rgba(255, 255, 255, 0.3);
}

.btn-pequeno {
    padding: 12px 24px;
    font-size: 0.9rem;
}

/* ============================================
   MODAIS HOLOGRÁFICAS
   ============================================ */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(5, 10, 25, 0.95);
    backdrop-filter: blur(20px);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    animation: modalFadeIn 0.5s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal.ativo {
    display: flex;
}

.modal-content {
    background: linear-gradient(
        145deg,
        rgba(10, 15, 35, 0.95) 0%,
        rgba(5, 10, 25, 0.95) 100%
    );
    border-radius: 30px;
    width: 90%;
    max-width: 700px;
    overflow: hidden;
    border: 1px solid var(--glass-border);
    box-shadow: 
        0 40px 80px rgba(0, 0, 0, 0.6),
        0 0 200px rgba(0, 243, 255, 0.2),
        inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    animation: modalSlideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes modalSlideUp {
    from { 
        opacity: 0; 
        transform: translateY(60px) perspective(1000px) rotateX(10deg);
        filter: blur(20px);
    }
    to { 
        opacity: 1; 
        transform: translateY(0) perspective(1000px) rotateX(0);
        filter: blur(0);
    }
}

.modal-header {
    padding: 30px;
    background: linear-gradient(
        90deg,
        rgba(0, 243, 255, 0.2) 0%,
        rgba(191, 0, 255, 0.2) 100%
    );
    border-bottom: 1px solid var(--glass-border);
}

.modal-header h3 {
    font-size: 1.8rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 15px;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.modal-body {
    padding: 35px;
    max-height: 70vh;
    overflow-y: auto;
}

.modal-footer {
    padding: 25px 35px;
    background: rgba(5, 10, 25, 0.8);
    border-top: 1px solid var(--glass-border);
    display: flex;
    justify-content: flex-end;
    gap: 20px;
}

/* ============================================
   FORMULÁRIOS FUTURISTAS
   ============================================ */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
}

.etapa {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 18px;
    border-radius: 15px;
    background: rgba(5, 10, 25, 0.5);
    transition: all 0.3s ease;
    cursor: pointer;
    border: 1px solid transparent;
}

.etapa:hover {
    border-color: rgba(0, 243, 255, 0.3);
    background: rgba(0, 243, 255, 0.05);
}

.etapa.ativo {
    background: rgba(0, 243, 255, 0.2);
    border-left: 4px solid var(--neon-blue);
    border-color: rgba(0, 243, 255, 0.3);
}

.etapa.concluido {
    background: rgba(0, 255, 136, 0.1);
    border-left: 4px solid var(--neon-green);
    border-color: rgba(0, 255, 136, 0.2);
}

.etapa-numero {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(5, 10, 25, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: var(--text-secondary);
    font-size: 1.2rem;
    border: 2px solid var(--glass-border);
}

.etapa.ativo .etapa-numero {
    background: var(--neon-blue);
    color: var(--dark-bg);
    border-color: var(--neon-blue);
    box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
}

.etapa.concluido .etapa-numero {
    background: var(--neon-green);
    color: var(--dark-bg);
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
}

/* ============================================
   ELEMENTOS ESPECIAIS
   ============================================ */
/* Switch moderno */
.switch-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 15px;
}

.switch {
    position: relative;
    display: inline-block;
    width: 70px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(5, 10, 25, 0.8);
    transition: .4s;
    border-radius: 34px;
    border: 2px solid rgba(0, 243, 255, 0.3);
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 2px;
    bottom: 2px;
    background: var(--text-secondary);
    transition: .4s;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}

input:checked + .slider {
    background: var(--primary-gradient);
    border-color: rgba(0, 243, 255, 0.5);
}

input:checked + .slider:before {
    transform: translateX(36px);
    background: white;
    box-shadow: 0 0 20px white;
}

/* Preview de foto */
.foto-preview-container {
    margin-top: 20px;
    text-align: center;
}

.foto-preview {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid var(--neon-blue);
    box-shadow: 
        0 0 30px rgba(0, 243, 255, 0.5),
        inset 0 0 20px rgba(0, 243, 255, 0.2);
    animation: photoGlow 3s infinite alternate;
}

@keyframes photoGlow {
    0% { box-shadow: 0 0 30px rgba(0, 243, 255, 0.5); }
    100% { box-shadow: 0 0 50px rgba(191, 0, 255, 0.7); }
}

.foto-placeholder {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background: rgba(5, 10, 25, 0.5);
    border: 4px dashed var(--neon-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    font-size: 0.9rem;
    text-align: center;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
}

.foto-placeholder::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        45deg,
        transparent 40%,
        rgba(0, 243, 255, 0.1) 50%,
        transparent 60%
    );
    animation: placeholderShine 3s infinite;
}

@keyframes placeholderShine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.file-input-wrapper {
    position: relative;
    margin-top: 10px;
}

.file-input-wrapper input[type="file"] {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    z-index: 2;
}

.file-input-label {
    display: inline-block;
    padding: 15px 30px;
    background: rgba(0, 243, 255, 0.1);
    border: 2px dashed var(--neon-blue);
    border-radius: 15px;
    color: var(--neon-blue);
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
    width: 100%;
    font-weight: 600;
    letter-spacing: 1px;
}

.file-input-label:hover {
    background: rgba(0, 243, 255, 0.2);
    border-color: var(--neon-purple);
    transform: translateY(-2px);
}

/* Coligação */
.coligacao-container {
    margin-top: 20px;
    padding: 20px;
    background: rgba(5, 10, 25, 0.5);
    border-radius: 15px;
    border: 1px solid rgba(0, 243, 255, 0.2);
}

.coligacao-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    background: rgba(10, 15, 35, 0.8);
    border-radius: 10px;
    margin-bottom: 10px;
    border: 1px solid rgba(0, 243, 255, 0.1);
    transition: all 0.3s ease;
}

.coligacao-item:hover {
    border-color: var(--neon-blue);
    background: rgba(0, 243, 255, 0.05);
}

.coligacao-remove {
    background: var(--danger);
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.coligacao-remove:hover {
    background: #ff3366;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(255, 85, 85, 0.5);
}

/* Validação de número */
.numero-validacao {
    font-size: 0.9rem;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 8px;
    background: rgba(5, 10, 25, 0.5);
}

.numero-validacao.valid {
    color: var(--success);
    border: 1px solid rgba(0, 255, 136, 0.3);
}

.numero-validacao.invalid {
    color: var(--danger);
    border: 1px solid rgba(255, 85, 85, 0.3);
}

/* ============================================
   ANIMAÇÕES ESPECIAIS
   ============================================ */
@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

@keyframes glow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

@keyframes scan {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
}

/* Elementos flutuantes */
.floating {
    animation: float 6s ease-in-out infinite;
}

/* Efeito de brilho */
.glow {
    animation: glow 2s ease-in-out infinite alternate;
}

/* Linha de scanner */
.scan-line {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--primary-gradient);
    animation: scan 2s linear infinite;
    opacity: 0.5;
}

/* ============================================
   RESPONSIVIDADE
   ============================================ */
@media (max-width: 1400px) {
    .container {
        padding: 15px;
    }
    
    .dashboard-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .abas-lateral {
        width: 250px;
    }
}

@media (max-width: 1024px) {
    .abas-container {
        flex-direction: column;
    }
    
    .abas-lateral {
        width: 100%;
        display: flex;
        overflow-x: auto;
        padding: 0;
        border-right: none;
        border-bottom: 1px solid var(--glass-border);
    }
    
    .aba-item {
        padding: 20px 25px;
        white-space: nowrap;
        border-left: none;
        border-bottom: 4px solid transparent;
        min-width: 200px;
    }
    
    .aba-item.ativo {
        border-left: none;
        border-bottom-color: var(--neon-blue);
    }
    
    .conteudo-abas {
        padding: 30px;
    }
    
    .dashboard-cards {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    header {
        flex-direction: column;
        text-align: center;
        gap: 25px;
        padding: 25px;
    }
    
    .logo-container {
        flex-direction: column;
        text-align: center;
    }
    
    .usuario-info {
        text-align: center;
        min-width: auto;
        width: 100%;
    }
    
    .filtros-grid {
        grid-template-columns: 1fr;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        width: 95%;
    }
    
    .modal-footer {
        flex-direction: column;
    }
    
    .modal-footer .btn {
        width: 100%;
    }
    
    .foto-preview, .foto-placeholder {
        width: 120px;
        height: 120px;
    }
}

@media (max-width: 480px) {
    body {
        padding: 10px;
    }
    
    .container {
        padding: 10px;
    }
    
    .conteudo-abas {
        padding: 20px;
    }
    
    .card {
        padding: 20px;
    }
    
    .card-valor {
        font-size: 2.5rem;
    }
    
    .btn {
        padding: 15px 25px;
        font-size: 0.9rem;
    }
    
    .filtros-container {
        padding: 25px;
    }
    
    .modal-body {
        padding: 25px;
    }
}

/* ============================================
   UTILITÁRIOS
   ============================================ */
.hidden {
    display: none !important;
}

.texto-centro {
    text-align: center;
}

.texto-direita {
    text-align: right;
}

.mb-20 { margin-bottom: 20px; }
.mb-30 { margin-bottom: 30px; }
.mb-40 { margin-bottom: 40px; }
.mt-20 { margin-top: 20px; }
.mt-30 { margin-top: 30px; }
.mt-40 { margin-top: 40px; }

/* Mensagens */
.mensagem {
    padding: 20px 25px;
    border-radius: 15px;
    margin-bottom: 25px;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 15px;
    border: 1px solid;
    backdrop-filter: blur(10px);
    animation: slideIn 0.5s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.mensagem-sucesso {
    background: rgba(0, 255, 136, 0.1);
    border-color: rgba(0, 255, 136, 0.3);
    color: var(--success);
    box-shadow: 0 10px 30px rgba(0, 255, 136, 0.1);
}

.mensagem-erro {
    background: rgba(255, 85, 85, 0.1);
    border-color: rgba(255, 85, 85, 0.3);
    color: var(--danger);
    box-shadow: 0 10px 30px rgba(255, 85, 85, 0.1);
}

.mensagem-aviso {
    background: rgba(255, 170, 0, 0.1);
    border-color: rgba(255, 170, 0, 0.3);
    color: var(--warning);
    box-shadow: 0 10px 30px rgba(255, 170, 0, 0.1);
}

/* Loading skeleton */
.skeleton {
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0.05) 25%,
        rgba(255, 255, 255, 0.1) 50%,
        rgba(255, 255, 255, 0.05) 75%
    );
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 10px;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Tooltips */
.tooltip {
    position: relative;
    cursor: help;
}

.tooltip-text {
    visibility: hidden;
    width: 300px;
    background: rgba(10, 15, 35, 0.95);
    color: var(--text-primary);
    text-align: left;
    border-radius: 10px;
    padding: 15px;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 300;
    border: 1px solid var(--glass-border);
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.4),
        0 0 80px rgba(0, 243, 255, 0.1);
    backdrop-filter: blur(20px);
}

.tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
    transform: translateX(-50%) translateY(-10px);
}

/* ============================================
   EFEITOS DE FOCO E DESTAQUE
   ============================================ */
:focus {
    outline: 2px solid var(--neon-blue);
    outline-offset: 2px;
}

::selection {
    background: var(--neon-blue);
    color: var(--dark-bg);
}

/* Scrollbar personalizada */
::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}

::-webkit-scrollbar-track {
    background: rgba(5, 10, 25, 0.5);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: var(--primary-gradient);
    border-radius: 10px;
    border: 3px solid rgba(5, 10, 25, 0.5);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--secondary-gradient);
}

/* ============================================
   ANIMAÇÃO DE ENTRADA
   ============================================ */
@keyframes pageLoad {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.98);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.container {
    animation: pageLoad 1s ease-out;
}

/* Efeito de partículas */
.particle {
    position: fixed;
    width: 2px;
    height: 2px;
    background: var(--neon-blue);
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
    animation: particleMove 20s linear infinite;
}

@keyframes particleMove {
    0% {
        transform: translate(0, 0);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    100% {
        transform: translate(var(--tx, 100px), var(--ty, 100px));
        opacity: 0;
    }
}

/* ============================================
   EFEITO DE CONEXÃO DE DADOS
   ============================================ */
.data-connection {
    position: relative;
}

.data-connection::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(0, 243, 255, 0.1) 50%,
        transparent 100%
    );
    animation: dataFlow 3s infinite;
    pointer-events: none;
}

@keyframes dataFlow {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}
        
        .foto-preview-container {
            margin-top: 10px;
            text-align: center;
        }
        
        .foto-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--electric-blue);
            box-shadow: 0 0 20px rgba(0, 180, 216, 0.3);
        }
        
        .foto-placeholder {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(10, 25, 47, 0.5);
            border: 3px dashed var(--electric-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--silver);
            font-size: 14px;
            text-align: center;
            margin: 0 auto;
        }
        
        .file-input-wrapper {
            position: relative;
            margin-top: 10px;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 12px 24px;
            background: rgba(0, 180, 216, 0.1);
            border: 2px dashed var(--electric-blue);
            border-radius: 12px;
            color: var(--electric-blue);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            width: 100%;
        }
        
        .file-input-label:hover {
            background: rgba(0, 180, 216, 0.2);
            border-color: var(--cyber-green);
        }
        
        .coligacao-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(10, 25, 47, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(0, 180, 216, 0.2);
        }
        
        .coligacao-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(17, 34, 64, 0.5);
            border-radius: 8px;
        }
        
        .coligacao-remove {
            background: var(--warning-red);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .numero-validacao {
            font-size: 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .numero-validacao.valid {
            color: var(--cyber-green);
        }
        
        .numero-validacao.invalid {
            color: var(--warning-red);
        }
        
        .switch-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: var(--silver);
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: linear-gradient(90deg, var(--electric-blue), var(--cyber-green));
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
            background-color: white;
        }
        
        .exclusao-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 0, 85, 0.05);
            border: 1px solid rgba(255, 0, 85, 0.2);
            border-radius: 12px;
        }
        
        .foto-candidato-tabela {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @media (max-width: 768px) {
            .foto-preview, .foto-placeholder {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-vote-yea"></i>
                </div>
                <div class="titulo-sistema">
                    <h1>TSE BROOKASIL 2026</h1>
                    <p>Sistema Eleitoral Nacional - Painel de Controle</p>
                </div>
            </div>
            <div class="usuario-info">
                <div class="usuario-nome" id="usuarioNome">SISTEMA PRINCIPAL</div>
                <div class="usuario-cargo" id="usuarioCargo">Aguardando Autenticação</div>
            </div>
        </header>

        <!-- Abas -->
        <div class="abas-container">
            <div class="abas-lateral">
                <div class="aba-item ativo" data-aba="dashboard">
                    <i class="fas fa-chart-network"></i>
                    <span>Painel Central</span>
                </div>
                <div class="aba-item" data-aba="candidatura">
                    <i class="fas fa-user-astronaut"></i>
                    <span>Registrar Candidatura</span>
                </div>
                <div class="aba-item" data-aba="analise">
                    <i class="fas fa-clipboard-list-check"></i>
                    <span>Análise de Candidaturas</span>
                </div>
                <div class="aba-item" data-aba="login">
                    <i class="fas fa-terminal"></i>
                    <span>Acesso TSE/TRE</span>
                </div>
                <div class="aba-item" data-aba="gerenciamento">
                    <i class="fas fa-cogs"></i>
                    <span>Controle Central</span>
                </div>
            </div>
            
            <div class="conteudo-abas">
                <!-- Dashboard -->
                <div class="aba-conteudo ativo" id="dashboard">
                    <h2 class="filtros-titulo mb-30">
                        <i class="fas fa-chart-network"></i>
                        Painel de Monitoramento Eleitoral
                    </h2>
                    
                    <!-- Cards de Estatísticas -->
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-titulo">
                                <i class="fas fa-users"></i>
                                CANDIDATOS REGISTRADOS
                            </div>
                            <div class="card-valor" id="totalCandidatos">0</div>
                            <div class="card-detalhe">Total no Sistema</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-titulo">
                                <i class="fas fa-shield-check"></i>
                                APROVADOS
                            </div>
                            <div class="card-valor" id="totalAprovados">0</div>
                            <div class="card-detalhe">Candidaturas Validadas</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-titulo">
                                <i class="fas fa-hourglass-half"></i>
                                EM ANÁLISE
                            </div>
                            <div class="card-valor" id="totalAnalise">0</div>
                            <div class="card-detalhe">Aguardando Aprovação</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-titulo">
                                <i class="fas fa-ban"></i>
                                RECUSADOS
                            </div>
                            <div class="card-valor" id="totalRecusados">0</div>
                            <div class="card-detalhe">Candidaturas Invalidadas</div>
                        </div>
                    </div>
                    
                    <!-- Filtros -->
                    <div class="filtros-container">
                        <h3 class="filtros-titulo">
                            <i class="fas fa-filter"></i>
                            Filtros de Visualização
                        </h3>
                        <div class="filtros-grid">
                            <div class="filtro-group">
                                <label class="filtro-label">Estado</label>
                                <select class="filtro-select" id="filtroEstado">
                                    <option value="">Todos os Estados</option>
                                    <!-- Estados serão preenchidos via JS -->
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <label class="filtro-label">Cidade</label>
                                <select class="filtro-select" id="filtroCidade">
                                    <option value="">Todas as Cidades</option>
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <label class="filtro-label">Cargo</label>
                                <select class="filtro-select" id="filtroCargo">
                                    <option value="">Todos os Cargos</option>
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <label class="filtro-label">Partido</label>
                                <select class="filtro-select" id="filtroPartido">
                                    <option value="">Todos os Partidos</option>
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <label class="filtro-label">Status</label>
                                <select class="filtro-select" id="filtroStatus">
                                    <option value="">Todos os Status</option>
                                    <option value="analise">Em Análise</option>
                                    <option value="aprovado">Aprovado</option>
                                    <option value="recusado">Recusado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="switch-container">
                            <label class="switch">
                                <input type="checkbox" id="toggleRecusados">
                                <span class="slider"></span>
                            </label>
                            <span class="card-detalhe">Mostrar candidatos recusados</span>
                        </div>
                    </div>
                    
                    <!-- Tabela de Candidatos -->
                    <div class="tabela-container">
                        <div class="tabela-header">
                            <h3><i class="fas fa-list"></i> Registros de Candidatura</h3>
                        </div>
                        <div class="tabela-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Foto</th>
                                        <th>Candidato</th>
                                        <th>Cargo</th>
                                        <th>Partido/Coligação</th>
                                        <th>Estado/Cidade</th>
                                        <th>Número</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaCandidatos">
                                    <!-- Dados serão preenchidos via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Registrar Candidatura -->
                <div class="aba-conteudo" id="candidatura">
                    <div class="filtros-container">
                        <h2 class="filtros-titulo mb-30">
                            <i class="fas fa-user-astronaut"></i>
                            Registro de Nova Candidatura
                        </h2>
                        
                        <!-- Etapas -->
                        <div class="form-grid mb-40" id="etapasFormulario">
                            <div class="etapa ativo" data-etapa="1">
                                <div class="etapa-numero">01</div>
                                <div class="etapa-nome">Dados Pessoais</div>
                            </div>
                            <div class="etapa" data-etapa="2">
                                <div class="etapa-numero">02</div>
                                <div class="etapa-nome">Partido e Número</div>
                            </div>
                            <div class="etapa" data-etapa="3">
                                <div class="etapa-numero">03</div>
                                <div class="etapa-nome">Vice/Suplente</div>
                            </div>
                            <div class="etapa" data-etapa="4">
                                <div class="etapa-numero">04</div>
                                <div class="etapa-nome">Confirmação</div>
                            </div>
                        </div>
                        
                        <!-- Formulário Etapa 1 -->
                        <div class="form-etapa-conteudo" id="etapa1">
                            <h3 class="mb-30">Dados do Candidato</h3>
                            <div class="form-grid">
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fas fa-id-card"></i>
                                        Nome Completo
                                    </label>
                                    <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                                        <input type="text" class="form-input" id="candidatoNome" placeholder="Nome" required>
                                        <input type="text" class="form-input" id="candidatoSobrenome" placeholder="Sobrenome" required>
                                    </div>
                                </div>
                                
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fas fa-camera"></i>
                                        Foto do Candidato
                                    </label>
                                    <div class="file-input-wrapper">
                                        <input type="file" id="candidatoFoto" accept="image/*" required>
                                        <div class="file-input-label">
                                            <i class="fas fa-upload"></i> Selecionar Foto (JPG/PNG, máx. 2MB)
                                        </div>
                                    </div>
                                    <div class="foto-preview-container">
                                        <div class="foto-placeholder">
                                            <i class="fas fa-user-circle fa-3x"></i>
                                            <div>Nenhuma foto selecionada</div>
                                        </div>
                                        <img id="fotoPreview" class="foto-preview hidden" alt="Pré-visualização">
                                    </div>
                                </div>
                                
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fab fa-tiktok"></i>
                                        Perfil TikTok
                                    </label>
                                    <input type="text" class="form-input" id="candidatoTiktok" placeholder="@usuario" required>
                                </div>
                                
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fas fa-compass"></i>
                                        Posicionamento Ideológico
                                    </label>
                                    <select class="form-select" id="candidatoIdeologia" required>
                                        <option value="">Selecione uma ideologia</option>
                                        <option value="direita">Direita</option>
                                        <option value="centro">Centro</option>
                                        <option value="esquerda">Esquerda</option>
                                    </select>
                                </div>
                                
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fas fa-briefcase"></i>
                                        Cargo Pretendido
                                    </label>
                                    <select class="form-select" id="candidatoCargo" required>
                                        <option value="">Selecione um cargo</option>
                                    </select>
                                </div>
                                
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fas fa-map-marked-alt"></i>
                                        Local de Candidatura
                                    </label>
                                    <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                                        <select class="form-select" id="candidatoEstado" required>
                                            <option value="">Estado</option>
                                        </select>
                                        <select class="form-select" id="candidatoCidade" disabled required>
                                            <option value="">Cidade</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-botoes mt-40">
                                <button class="btn btn-primario" id="btnEtapa1">
                                    Continuar <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Formulário Etapa 2 -->
                        <div class="form-etapa-conteudo hidden" id="etapa2">
                            <h3 class="mb-30">Filiação Partidária</h3>
                            <div class="form-grid">
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fas fa-landmark"></i>
                                        Partido Político
                                    </label>
                                    <select class="form-select" id="candidatoPartido" required>
                                        <option value="">Selecione um partido</option>
                                    </select>
                                </div>
                                
                                <div class="filtro-group">
                                    <label class="filtro-label">
                                        <i class="fas fa-hashtag"></i>
                                        Número de Candidatura
                                    </label>
                                    <input type="text" class="form-input" id="candidatoNumero" 
                                           pattern="\d{2,5}" maxlength="5" required>
                                    <div class="numero-validacao" id="validacaoNumero"></div>
                                </div>
                                
                                <!-- Coligação (apenas para cargos de 2 dígitos) -->
                                <div class="filtro-group hidden" id="coligacaoContainer">
                                    <label class="filtro-label">
                                        <i class="fas fa-handshake"></i>
                                        Coligação (Opcional)
                                    </label>
                                    <div class="coligacao-container">
                                        <div id="coligacaoLista">
                                            <!-- Partidos da coligação serão adicionados aqui -->
                                        </div>
                                        <div class="form-grid" style="grid-template-columns: 1fr auto; gap: 10px; margin-top: 10px;">
                                            <select class="form-select" id="coligacaoPartido">
                                                <option value="">Adicionar partido à coligação</option>
                                            </select>
                                            <button type="button" class="btn btn-secundario btn-pequeno" id="btnAddColigacao">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-botoes mt-40">
                                <button class="btn btn-secundario" id="btnVoltarEtapa2">
                                    <i class="fas fa-arrow-left"></i> Voltar
                                </button>
                                <button class="btn btn-primario" id="btnEtapa2">
                                    Continuar <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Formulário Etapa 3 -->
                        <div class="form-etapa-conteudo hidden" id="etapa3">
                            <h3 class="mb-30">Composição da Chapa</h3>
                            <div id="conteudoEtapa3">
                                <!-- Conteúdo dinâmico baseado no cargo -->
                            </div>
                            
                            <div class="form-botoes mt-40">
                                <button class="btn btn-secundario" id="btnVoltarEtapa3">
                                    <i class="fas fa-arrow-left"></i> Voltar
                                </button>
                                <button class="btn btn-primario" id="btnEtapa3">
                                    Continuar <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Formulário Etapa 4 -->
                        <div class="form-etapa-conteudo hidden" id="etapa4">
                            <h3 class="mb-30">Confirmação Final</h3>
                            
                            <div class="mensagem mensagem-aviso mb-30">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div>
                                    <strong>Declaração de Uso:</strong> Sistema para fins de simulação eleitoral.
                                    Dados fictícios para Roleplay (RP).
                                </div>
                            </div>
                            
                            <div class="card mb-30">
                                <h3 class="card-titulo mb-20">Resumo da Candidatura</h3>
                                <div id="resumoCandidatura"></div>
                            </div>
                            
                            <div class="form-botoes mt-40">
                                <button class="btn btn-secundario" id="btnVoltarEtapa4">
                                    <i class="fas fa-arrow-left"></i> Voltar
                                </button>
                                <button class="btn btn-terciario" id="btnEnviarCandidatura">
                                    <i class="fas fa-paper-plane"></i> Submeter Candidatura
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Análise de Candidaturas -->
                <div class="aba-conteudo" id="analise">
                    <div class="filtros-container">
                        <h2 class="filtros-titulo mb-30">
                            <i class="fas fa-clipboard-list-check"></i>
                            Sistema de Análise de Candidaturas
                        </h2>
                        
                        <div class="mensagem mensagem-aviso hidden" id="mensagemAnalise">
                            <i class="fas fa-shield-alt"></i>
                            <div>Acesso restrito. Autentique-se como TRE ou TSE Nacional para acessar esta área.</div>
                        </div>
                        
                        <!-- Tabela de Análise -->
                        <div class="tabela-container" id="tabelaAnaliseContainer">
                            <div class="tabela-header">
                                <h3><i class="fas fa-tasks"></i> Candidaturas para Análise</h3>
                                <div style="margin-top: 10px;">
                                    <select class="form-select" id="filtroStatusAnalise" style="width: auto;">
                                        <option value="todos">Todos os Status</option>
                                        <option value="analise">Em Análise</option>
                                        <option value="aprovado">Aprovados</option>
                                        <option value="recusado">Recusados</option>
                                    </select>
                                </div>
                            </div>
                            <div class="tabela-content">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Foto</th>
                                            <th>Candidato</th>
                                            <th>Cargo</th>
                                            <th>Partido/Coligação</th>
                                            <th>Local</th>
                                            <th>Número</th>
                                            <th>Status</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaAnalise"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Login -->
                <div class="aba-conteudo" id="login">
                    <div style="max-width: 600px; margin: 0 auto;">
                        <h2 class="filtros-titulo texto-centro mb-40">
                            <i class="fas fa-terminal"></i>
                            Sistema de Autenticação
                        </h2>
                        
                        <div class="filtros-container">
                            <div class="login-opcoes" style="display: flex; gap: 20px; margin-bottom: 30px;">
                                <div class="login-opcao ativo" data-tipo="tse">
                                    <i class="fas fa-landmark"></i>
                                    <h3>TSE Nacional</h3>
                                    <p>Acesso Administrativo Completo</p>
                                </div>
                                <div class="login-opcao" data-tipo="tre">
                                    <i class="fas fa-balance-scale"></i>
                                    <h3>TRE Regional</h3>
                                    <p>Acesso Regional para Análise</p>
                                </div>
                            </div>
                            
                            <!-- Formulário TSE -->
                            <div id="formLoginTSE">
                                <h3 class="mb-30">Acesso TSE Nacional</h3>
                                <div class="form-grid">
                                    <div class="filtro-group">
                                        <label class="filtro-label">
                                            <i class="fas fa-user-tie"></i>
                                            Usuário TSE
                                        </label>
                                        <input type="text" class="form-input" id="tseUsuario" 
                                               placeholder="Insira o usuário do TSE" required>
                                    </div>
                                    
                                    <div class="filtro-group">
                                        <label class="filtro-label">
                                            <i class="fas fa-key"></i>
                                            Senha de Acesso
                                        </label>
                                        <input type="password" class="form-input" id="tseSenha" 
                                               placeholder="Insira a senha do TSE" required>
                                    </div>
                                </div>
                                
                                <div class="form-botoes mt-40">
                                    <button class="btn btn-primario" id="btnLoginTSE">
                                        <i class="fas fa-sign-in-alt"></i>
                                        Autenticar como TSE
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Formulário TRE -->
                            <div class="hidden" id="formLoginTRE">
                                <h3 class="mb-30">Acesso TRE Regional</h3>
                                <div class="form-grid">
                                    <div class="filtro-group">
                                        <label class="filtro-label">
                                            <i class="fas fa-map-marked-alt"></i>
                                            Jurisdição do TRE
                                        </label>
                                        <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                                            <select class="form-select" id="treEstado" required>
                                                <option value="">Selecione o Estado</option>
                                            </select>
                                            <select class="form-select" id="treCidade" disabled required>
                                                <option value="">Selecione a Cidade</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="filtro-group">
                                        <label class="filtro-label">
                                            <i class="fas fa-user-tie"></i>
                                            Usuário TRE
                                        </label>
                                        <input type="text" class="form-input" id="treUsuario" 
                                               placeholder="Insira o usuário do TRE" required>
                                    </div>
                                    
                                    <div class="filtro-group">
                                        <label class="filtro-label">
                                            <i class="fas fa-key"></i>
                                            Senha de Acesso
                                        </label>
                                        <input type="password" class="form-input" id="treSenha" 
                                               placeholder="Insira a senha do TRE" required>
                                    </div>
                                </div>
                                
                                <div class="form-botoes mt-40">
                                    <button class="btn btn-primario" id="btnLoginTRE">
                                        <i class="fas fa-sign-in-alt"></i>
                                        Autenticar como TRE
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gerenciamento TSE -->
                <div class="aba-conteudo" id="gerenciamento">
                    <div class="filtros-container">
                        <h2 class="filtros-titulo mb-30">
                            <i class="fas fa-cogs"></i>
                            Controle Central do Sistema
                        </h2>
                        
                        <div class="mensagem mensagem-aviso" id="mensagemGerenciamento">
                            <i class="fas fa-lock"></i>
                            <div>Acesso exclusivo para TSE Nacional. Autentique-se para acessar.</div>
                        </div>
                        
                        <!-- Conteúdo do Gerenciamento -->
                        <div class="hidden" id="conteudoGerenciamento">
                            <div class="dashboard-cards mb-40">
                                <div class="card">
                                    <div class="card-titulo">
                                        <i class="fas fa-toggle-on"></i>
                                        STATUS DO SISTEMA
                                    </div>
                                    <div class="card-valor" id="statusEleicao">OFFLINE</div>
                                    <div class="card-detalhe mt-20">
                                        <button class="btn btn-terciario btn-pequeno" id="btnAlternarEleicao">
                                            <i class="fas fa-power-off"></i>
                                            Ativar Sistema
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-titulo">
                                        <i class="fas fa-vote-yea"></i>
                                        MODO DE ELEIÇÃO
                                    </div>
                                    <div class="card-valor" id="tipoEleicao">NÃO CONFIGURADO</div>
                                    <div class="card-detalhe mt-20">
                                        <select class="form-select" id="selectTipoEleicao">
                                            <option value="">Selecionar Tipo</option>
                                            <option value="municipal">Eleição Municipal</option>
                                            <option value="federal">Eleição Federal</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-titulo">
                                        <i class="fas fa-landmark"></i>
                                        PARTIDOS REGISTRADOS
                                    </div>
                                    <div class="card-valor" id="totalPartidos">51</div>
                                    <div class="card-detalhe">Ativos no Sistema</div>
                                </div>
                            </div>
                            
                            <!-- Controle de Exclusão -->
                            <div class="exclusao-container">
                                <h3 class="mb-20">
                                    <i class="fas fa-trash-alt"></i>
                                    Controle de Exclusão de Candidaturas
                                </h3>
                                <p class="card-detalhe mb-20">
                                    <strong>ATENÇÃO:</strong> Esta ação é irreversível e disponível apenas para TSE Nacional.
                                    Use com extremo cuidado.
                                </p>
                                <div class="form-grid" style="grid-template-columns: 2fr 1fr; gap: 20px;">
                                    <div>
                                        <input type="text" class="form-input" id="filtroExclusao" 
                                               placeholder="Buscar candidatura por nome, número ou partido...">
                                    </div>
                                    <div>
                                        <button class="btn btn-secundario" id="btnBuscarExclusao">
                                            <i class="fas fa-search"></i> Buscar
                                        </button>
                                    </div>
                                </div>
                                <div id="resultadosExclusao" class="mt-20"></div>
                            </div>
                            
                            <!-- Controle de Partidos -->
                            <div class="tabela-container mt-40">
                                <div class="tabela-header">
                                    <h3><i class="fas fa-list"></i> Sistema de Partidos Políticos</h3>
                                </div>
                                <div class="tabela-content">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Sigla</th>
                                                <th>Número</th>
                                                <th>Nome Completo</th>
                                                <th>Posicionamento</th>
                                                <th>Tipo</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabelaPartidos"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes -->
    <div class="modal" id="modalDetalhes">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-tie"></i> Detalhes da Candidatura</h3>
            </div>
            <div class="modal-body">
                <div id="conteudoModalDetalhes"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secundario" id="btnFecharModal">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Análise -->
    <div class="modal" id="modalAnalise">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-clipboard-check"></i> Análise de Candidatura</h3>
            </div>
            <div class="modal-body">
                <div id="conteudoModalAnalise"></div>
                <div class="filtro-group mt-30">
                    <label class="filtro-label">Motivo da Decisão</label>
                    <textarea class="form-input" id="motivoDecisao" rows="3" 
                              placeholder="Informe detalhadamente o motivo da aprovação/recusa"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secundario" id="btnCancelarAnalise">Cancelar</button>
                <button class="btn" id="btnRecusarCandidatura">
                    <i class="fas fa-times"></i> Recusar
                </button>
                <button class="btn btn-terciario" id="btnAprovarCandidatura">
                    <i class="fas fa-check"></i> Aprovar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Exclusão -->
    <div class="modal" id="modalExclusao">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h3>
            </div>
            <div class="modal-body">
                <div id="conteudoModalExclusao"></div>
                <div class="filtro-group mt-30">
                    <label class="filtro-label">Motivo da Exclusão</label>
                    <textarea class="form-input" id="motivoExclusao" rows="3" 
                              placeholder="Informe o motivo da exclusão (obrigatório)" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secundario" id="btnCancelarExclusao">Cancelar</button>
                <button class="btn" id="btnConfirmarExclusao">
                    <i class="fas fa-trash-alt"></i> Excluir Permanentemente
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuração Firebase
        const firebaseConfig = {
            apiKey: "SUA_API_KEY_AQUI",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            databaseURL: "https://SEU_PROJETO.firebaseio.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();
        const auth = firebase.auth();

        // Dados do Sistema (mantendo os mesmos)
        const DADOS_SISTEMA = {
            estados: [
                { nome: "BROOKHAVEN", cidades: ["Cidade Eleitoral", "Liberty City"] },
                { nome: "NOVACORE", cidades: ["Nexaville", "Solária"] },
                { nome: "CASTERÍBER", cidades: ["Castelo Verde", "Monte Prata"] },
                { nome: "FORTEMEGA", cidades: ["Marinha City", "Porto Rubi"] },
                { nome: "FLORÊMIX", cidades: ["Florápolis", "Riomarina"] },
                { nome: "BRAVILAND", cidades: ["Soberana", "Vila Coletiva"] }
            ],
            
            tiposEleicao: {
                municipal: {
                    nome: "Eleição Municipal",
                    cargos: [
                        { nome: "Prefeito", digitos: 2 },
                        { nome: "Vereador", digitos: 5 }
                    ]
                },
                federal: {
                    nome: "Eleição Federal",
                    cargos: [
                        { nome: "Presidente", digitos: 2 },
                        { nome: "Governador", digitos: 2 },
                        { nome: "Senador", digitos: 3 },
                        { nome: "Deputado Federal", digitos: 4 },
                        { nome: "Deputado Estadual", digitos: 5 }
                    ]
                }
            },
            
            partidos: {
                direita: [
                    { sigla: "PL", numero: 22, nome: "Partido Liberal" },
                    { sigla: "PP", numero: 11, nome: "Progressistas" },
                    { sigla: "Republicanos", numero: 10, nome: "Republicanos" },
                    { sigla: "NOVO", numero: 30, nome: "Partido Novo" },
                    { sigla: "PRD", numero: 25, nome: "Partido Renovação Democrática" },
                    { sigla: "Patriota", numero: 51, nome: "Patriota" },
                    { sigla: "PRTB", numero: 28, nome: "Partido Renovador Trabalhista Brasileiro" },
                    { sigla: "DC", numero: 27, nome: "Democracia Cristã" },
                    { sigla: "Agir", numero: 36, nome: "Agir" },
                    { sigla: "PMB", numero: 35, nome: "Partido da Mulher Brasileira" },
                    { sigla: "UDB", numero: 38, nome: "União da Direita Brookasileira" },
                    { sigla: "POL", numero: 81, nome: "Partido da Ordem e Liberdade" },
                    { sigla: "ACN", numero: 84, nome: "Aliança Cristã Nacional" },
                    { sigla: "PRONA", numero: 57, nome: "Partido da Reedificação da Ordem Nacional" },
                    { sigla: "PSL", numero: 17, nome: "Partido Social Liberal" },
                    { sigla: "PESP", numero: 48, nome: "Partido da Esperança" },
                    { sigla: "PMNL", numero: 86, nome: "Partido Militar Nacionalista" },
                    { sigla: "PRTN", numero: 75, nome: "Partido Republicano Trabalhista Nacional" }
                ],
                centro: [
                    { sigla: "MDB", numero: 15, nome: "Movimento Democrático Brasileiro" },
                    { sigla: "UNIÃO", numero: 44, nome: "União Brasil" },
                    { sigla: "PSD", numero: 55, nome: "Partido Social Democrático" },
                    { sigla: "Podemos", numero: 20, nome: "Podemos" },
                    { sigla: "PSDB", numero: 45, nome: "Partido da Social Democracia Brasileira" },
                    { sigla: "Cidadania", numero: 23, nome: "Cidadania (CDN)" },
                    { sigla: "Solidariedade", numero: 77, nome: "Solidariedade" },
                    { sigla: "Avante", numero: 70, nome: "Avante" },
                    { sigla: "PMN", numero: 33, nome: "Partido da Mobilização Nacional" },
                    { sigla: "PROS", numero: 90, nome: "PROS" },
                    { sigla: "PV", numero: 43, nome: "Partido Verde" },
                    { sigla: "PUN", numero: 42, nome: "Partido da União Nacional" },
                    { sigla: "MPD", numero: 37, nome: "Movimento Popular Democrático" },
                    { sigla: "PDM", numero: 26, nome: "Partido da Mudança" },
                    { sigla: "MTB", numero: 63, nome: "Movimento Trabalhista Brookasileiro" },
                    { sigla: "PTD", numero: 46, nome: "Partido Trabalhista Democrático" },
                    { sigla: "PDSD", numero: 88, nome: "Partido do Sindicato Democrata" },
                    { sigla: "MSS", numero: 14, nome: "Partido Missão" },
                    { sigla: "PC", numero: 85, nome: "Partido Construção" }
                ],
                esquerda: [
                    { sigla: "PT", numero: 13, nome: "Partido dos Trabalhadores" },
                    { sigla: "PSOL", numero: 50, nome: "Partido Socialismo e Liberdade" },
                    { sigla: "PCdoB", numero: 65, nome: "Partido Comunista do Brasil" },
                    { sigla: "REDE", numero: 18, nome: "Rede Sustentabilidade" },
                    { sigla: "PDT", numero: 12, nome: "Partido Democrático Trabalhista" },
                    { sigla: "UP", numero: 80, nome: "Unidade Popular" },
                    { sigla: "PCO", numero: 29, nome: "Partido da Causa Operária" },
                    { sigla: "PCB", numero: 21, nome: "Partido Comunista Brasileiro" },
                    { sigla: "PSTU", numero: 16, nome: "Partido Socialista dos Trabalhadores Unificado" },
                    { sigla: "PPL", numero: 54, nome: "Partido Pátria Livre" },
                    { sigla: "PSB", numero: 40, nome: "Partido Socialista Brasileiro" },
                    { sigla: "PFS", numero: 60, nome: "Partido da Frente Socialista" },
                    { sigla: "PS", numero: 56, nome: "Partido Socialista" },
                    { sigla: "PSTN", numero: 31, nome: "Partido Social Trabalhista Nacional" }
                ]
            }
        };

        // Estado do Sistema
        let estadoSistema = {
            usuarioAutenticado: false,
            tipoUsuario: null,
            usuarioInfo: null,
            tipoEleicaoAtual: null,
            eleicaoAberta: false,
            candidaturas: [],
            etapaAtual: 1,
            dadosCandidatura: {
                etapa1: {},
                etapa2: {},
                etapa3: {},
                etapa4: {}
            },
            coligacao: [],
            fotoFile: null
        };

        // Variáveis globais para modais
        let candidaturaEmAnalise = null;
        let candidaturaParaExcluir = null;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            inicializarFirebase();
            inicializarSistema();
            carregarDadosIniciais();
            configurarEventListeners();
            carregarCandidaturasFirebase();
            verificarAutenticacao();
        });

        // Funções Firebase
        function inicializarFirebase() {
            // Configuração personalizada do Firebase
            const config = {
                apiKey: "AIzaSyABCDEFGHIJKLMNOPQRSTUVWXYZ012345678",
                authDomain: "tse-brookasil.firebaseapp.com",
                databaseURL: "https://tse-brookasil-default-rtdb.firebaseio.com",
                projectId: "tse-brookasil",
                storageBucket: "tse-brookasil.appspot.com",
                messagingSenderId: "123456789012",
                appId: "1:123456789012:web:abcdef1234567890abcdef"
            };
            
            // Inicializar apenas se não estiver inicializado
            if (!firebase.apps.length) {
                firebase.initializeApp(config);
            }
        }

        async function carregarCandidaturasFirebase() {
            try {
                const snapshot = await database.ref('candidaturas').once('value');
                const data = snapshot.val();
                
                if (data) {
                    // Converter objeto para array
                    const candidaturasArray = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    
                    estadoSistema.candidaturas = candidaturasArray;
                    console.log(`✅ ${candidaturasArray.length} candidaturas carregadas do Firebase`);
                }
                
                // Carregar configuração do sistema
                const configSnapshot = await database.ref('config').once('value');
                const configData = configSnapshot.val();
                
                if (configData) {
                    estadoSistema.tipoEleicaoAtual = configData.tipoEleicaoAtual || null;
                    estadoSistema.eleicaoAberta = configData.eleicaoAberta || false;
                    atualizarStatusEleicaoUI();
                }
                
                atualizarDashboard();
                atualizarTabelaCandidatos();
                
            } catch (error) {
                console.error("❌ Erro ao carregar dados do Firebase:", error);
                mostrarMensagem("Erro ao conectar com o banco de dados", "erro");
            }
        }

        async function salvarCandidaturaFirebase(candidatura) {
            try {
                // Gerar ID único
                const id = Date.now() + Math.floor(Math.random() * 1000);
                candidatura.id = id.toString();
                
                // Salvar no Firebase
                await database.ref(`candidaturas/${candidatura.id}`).set(candidatura);
                
                // Atualizar estado local
                estadoSistema.candidaturas.push(candidatura);
                
                return candidatura.id;
                
            } catch (error) {
                console.error("❌ Erro ao salvar candidatura:", error);
                throw error;
            }
        }

        async function atualizarCandidaturaFirebase(id, dados) {
            try {
                await database.ref(`candidaturas/${id}`).update(dados);
                
                // Atualizar estado local
                const index = estadoSistema.candidaturas.findIndex(c => c.id === id);
                if (index !== -1) {
                    estadoSistema.candidaturas[index] = { ...estadoSistema.candidaturas[index], ...dados };
                }
                
            } catch (error) {
                console.error("❌ Erro ao atualizar candidatura:", error);
                throw error;
            }
        }

        async function excluirCandidaturaFirebase(id) {
            try {
                // Buscar candidatura para deletar foto do storage
                const candidatura = estadoSistema.candidaturas.find(c => c.id === id);
                if (candidatura && candidatura.fotoUrl) {
                    try {
                        const fotoRef = storage.refFromURL(candidatura.fotoUrl);
                        await fotoRef.delete();
                    } catch (error) {
                        console.warn("⚠️ Não foi possível deletar a foto:", error);
                    }
                }
                
                // Deletar do Realtime Database
                await database.ref(`candidaturas/${id}`).remove();
                
                // Atualizar estado local
                estadoSistema.candidaturas = estadoSistema.candidaturas.filter(c => c.id !== id);
                
                return true;
                
            } catch (error) {
                console.error("❌ Erro ao excluir candidatura:", error);
                throw error;
            }
        }

        async function uploadFoto(file) {
            return new Promise((resolve, reject) => {
                const nomeArquivo = `candidatos/${Date.now()}_${file.name}`;
                const uploadTask = storage.ref(nomeArquivo).put(file);
                
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Progresso do upload
                        const progresso = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log(`Upload: ${progresso}% concluído`);
                    },
                    (error) => {
                        reject(error);
                    },
                    () => {
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            resolve(downloadURL);
                        });
                    }
                );
            });
        }

        async function salvarConfiguracaoFirebase() {
            try {
                await database.ref('config').set({
                    tipoEleicaoAtual: estadoSistema.tipoEleicaoAtual,
                    eleicaoAberta: estadoSistema.eleicaoAberta,
                    ultimaAtualizacao: new Date().toISOString()
                });
            } catch (error) {
                console.error("❌ Erro ao salvar configuração:", error);
            }
        }

        // Funções de Inicialização
        function inicializarSistema() {
            console.log("⚡ Sistema Eleitoral Brookasil 2026 - Inicializado");
            console.log("🔒 Versão: 3.0.0 - Sistema Anti-Burla");
            console.log("🌐 Firebase: Conectado");
        }

        // Adicione estas funções no seu código JavaScript:

// ============================================
// SISTEMA DE CONTROLE DE ELEIÇÃO CORRIGIDO
// ============================================

// Referência para a configuração global
let configEleicaoRef = null;

// Inicializar sistema de eleição
function inicializarSistemaEleicao() {
    console.log("🔧 Inicializando sistema de eleição...");
    
    // Referência para configuração global
    configEleicaoRef = database.ref('config/sistema_eleicao');
    
    // Ouvir mudanças em tempo real
    configEleicaoRef.on('value', (snapshot) => {
        const config = snapshot.val();
        if (config) {
            console.log("📡 Configuração de eleição recebida:", config);
            
            estadoSistema.eleicaoAberta = config.eleicaoAberta || false;
            estadoSistema.tipoEleicaoAtual = config.tipoEleicao || null;
            
            // Atualizar UI imediatamente
            atualizarStatusEleicaoUI();
            
            // Se estiver na aba de gerenciamento, atualizar controles
            if (estadoSistema.tipoUsuario === 'tse' && 
                document.getElementById('gerenciamento').classList.contains('ativo')) {
                atualizarControlesEleicao();
            }
            
            // Verificar se precisa notificar sobre mudança
            if (estadoSistema.eleicaoAberta && !config.lastNotification) {
                mostrarNotificacaoSistema();
            }
        }
    }, (error) => {
        console.error("❌ Erro ao escutar configuração:", error);
        mostrarMensagem("Erro de conexão com servidor", "erro");
    });
    
    // Carregar configuração inicial
    carregarConfiguracaoEleicao();
}

// Carregar configuração atual
async function carregarConfiguracaoEleicao() {
    try {
        const snapshot = await configEleicaoRef.once('value');
        const config = snapshot.val();
        
        if (!config) {
            // Configuração inicial padrão
            const configInicial = {
                eleicaoAberta: false,
                tipoEleicao: null,
                dataCriacao: new Date().toISOString(),
                criadoPor: "Sistema",
                ultimaAtualizacao: new Date().toISOString(),
                versao: "3.0.0"
            };
            
            await configEleicaoRef.set(configInicial);
            estadoSistema.eleicaoAberta = false;
            estadoSistema.tipoEleicaoAtual = null;
        } else {
            estadoSistema.eleicaoAberta = config.eleicaoAberta || false;
            estadoSistema.tipoEleicaoAtual = config.tipoEleicao || null;
        }
        
        atualizarStatusEleicaoUI();
        
    } catch (error) {
        console.error("❌ Erro ao carregar configuração:", error);
    }
}

// Função CORRIGIDA para alternar status da eleição
async function alternarStatusEleicao() {
    if (!estadoSistema.usuarioAutenticado || estadoSistema.tipoUsuario !== 'tse') {
        mostrarMensagem("❌ Apenas o TSE pode alterar o status do sistema", "erro");
        return;
    }
    
    const novoStatus = !estadoSistema.eleicaoAberta;
    const btn = document.getElementById('btnAlternarEleicao');
    const originalText = btn.innerHTML;
    
    try {
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
        btn.disabled = true;
        
        // Atualizar no Firebase
        await configEleicaoRef.update({
            eleicaoAberta: novoStatus,
            ultimaAtualizacao: new Date().toISOString(),
            atualizadoPor: estadoSistema.usuarioInfo.nome,
            ultimaAlteracao: {
                tipo: 'status',
                valor: novoStatus ? 'ATIVADO' : 'DESATIVADO',
                data: new Date().toISOString(),
                usuario: estadoSistema.usuarioInfo.nome
            }
        });
        
        // O listener on('value') irá atualizar automaticamente
        console.log(`✅ Sistema ${novoStatus ? 'ATIVADO' : 'DESATIVADO'} com sucesso!`);
        
        // Forçar atualização imediata
        estadoSistema.eleicaoAberta = novoStatus;
        atualizarStatusEleicaoUI();
        
        // Mostrar notificação
        mostrarMensagem(
            novoStatus ? 
            "🎉 SISTEMA ATIVADO - Candidaturas liberadas!" : 
            "⏸️ SISTEMA DESATIVADO - Candidaturas bloqueadas",
            novoStatus ? "sucesso" : "aviso"
        );
        
        // Se ativou sem tipo definido, alertar
        if (novoStatus && !estadoSistema.tipoEleicaoAtual) {
            mostrarMensagem("⚠️ ATENÇÃO: Tipo de eleição não definido", "aviso");
        }
        
    } catch (error) {
        console.error("❌ Erro ao alternar status:", error);
        mostrarMensagem("Erro ao atualizar sistema. Tente novamente.", "erro");
    } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
    }
}

// Função CORRIGIDA para alterar tipo de eleição
async function alterarTipoEleicao(novoTipo) {
    if (!estadoSistema.usuarioAutenticado || estadoSistema.tipoUsuario !== 'tse') {
        mostrarMensagem("❌ Apenas o TSE pode alterar o tipo de eleição", "erro");
        return;
    }
    
    try {
        // Atualizar no Firebase
        await configEleicaoRef.update({
            tipoEleicao: novoTipo,
            ultimaAtualizacao: new Date().toISOString(),
            atualizadoPor: estadoSistema.usuarioInfo.nome,
            ultimaAlteracao: {
                tipo: 'tipo_eleicao',
                valor: novoTipo,
                data: new Date().toISOString(),
                usuario: estadoSistema.usuarioInfo.nome
            }
        });
        
        // O listener irá atualizar automaticamente
        console.log(`✅ Tipo de eleição alterado para: ${novoTipo}`);
        
        // Mostrar notificação
        mostrarMensagem(
            `✅ Tipo de eleição definido: ${novoTipo === 'municipal' ? 'Municipal' : 'Federal'}`,
            "sucesso"
        );
        
        // Se sistema estava ativo, notificar sobre a mudança
        if (estadoSistema.eleicaoAberta) {
            setTimeout(() => {
                mostrarMensagem(
                    `ℹ️ Sistema atualizado para: ${novoTipo === 'municipal' ? 'Eleição Municipal' : 'Eleição Federal'}`,
                    "aviso"
                );
            }, 1000);
        }
        
    } catch (error) {
        console.error("❌ Erro ao alterar tipo de eleição:", error);
        mostrarMensagem("Erro ao atualizar tipo de eleição", "erro");
    }
}

// Atualizar UI do status da eleição
function atualizarStatusEleicaoUI() {
    // Atualizar cabeçalho do sistema
    document.getElementById('usuarioCargo').textContent = 
        estadoSistema.eleicaoAberta ? "SISTEMA ONLINE" : "SISTEMA OFFLINE";
    
    // Atualizar na aba de gerenciamento (se visível)
    const statusEleicaoEl = document.getElementById('statusEleicao');
    const btnAlternarEleicaoEl = document.getElementById('btnAlternarEleicao');
    const tipoEleicaoEl = document.getElementById('tipoEleicao');
    const selectTipoEleicaoEl = document.getElementById('selectTipoEleicao');
    
    if (statusEleicaoEl) {
        statusEleicaoEl.textContent = 
            estadoSistema.eleicaoAberta ? "SISTEMA ONLINE" : "SISTEMA OFFLINE";
        statusEleicaoEl.style.color = estadoSistema.eleicaoAberta ? "#00ff88" : "#ff5555";
    }
    
    if (btnAlternarEleicaoEl) {
        btnAlternarEleicaoEl.innerHTML = estadoSistema.eleicaoAberta ? 
            '<i class="fas fa-power-off"></i> Desativar Sistema' : 
            '<i class="fas fa-power-off"></i> Ativar Sistema';
        btnAlternarEleicaoEl.style.background = estadoSistema.eleicaoAberta ? 
            'linear-gradient(135deg, #ff5555, #ff3366)' : 
            'linear-gradient(135deg, #00ff88, #00cc66)';
    }
    
    if (tipoEleicaoEl) {
        tipoEleicaoEl.textContent = estadoSistema.tipoEleicaoAtual ? 
            estadoSistema.tipoEleicaoAtual.toUpperCase() : "NÃO CONFIGURADO";
    }
    
    if (selectTipoEleicaoEl) {
        selectTipoEleicaoEl.value = estadoSistema.tipoEleicaoAtual || "";
    }
    
    // Atualizar todos os lugares que mostram status
    atualizarIndicadoresStatus();
}

// Atualizar controles da eleição
function atualizarControlesEleicao() {
    // Garantir que os controles estão atualizados
    atualizarStatusEleicaoUI();
    
    // Habilitar/desabilitar controles baseado no status
    const selectTipo = document.getElementById('selectTipoEleicao');
    if (selectTipo) {
        selectTipo.disabled = false;
    }
}

// Atualizar indicadores em todas as partes do sistema
function atualizarIndicadoresStatus() {
    // Atualizar status na tabela de candidaturas
    const indicadores = document.querySelectorAll('.status-indicador');
    indicadores.forEach(el => {
        el.textContent = estadoSistema.eleicaoAberta ? "🟢 ONLINE" : "🔴 OFFLINE";
        el.style.color = estadoSistema.eleicaoAberta ? "#00ff88" : "#ff5555";
    });
}

// Mostrar notificação de sistema
function mostrarNotificacaoSistema() {
    if (estadoSistema.eleicaoAberta) {
        const notificacao = document.createElement('div');
        notificacao.className = 'notificacao-sistema';
        notificacao.innerHTML = `
            <div class="notificacao-conteudo">
                <i class="fas fa-bullhorn"></i>
                <div>
                    <strong>🎉 SISTEMA ELETORAL ATIVADO!</strong>
                    <p>Candidaturas agora estão abertas para: ${estadoSistema.tipoEleicaoAtual === 'municipal' ? 'Eleição Municipal' : 'Eleição Federal'}</p>
                </div>
                <button class="notificacao-fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        document.body.appendChild(notificacao);
        
        // Fechar notificação
        notificacao.querySelector('.notificacao-fechar').addEventListener('click', () => {
            notificacao.remove();
        });
        
        // Remover automaticamente após 10 segundos
        setTimeout(() => notificacao.remove(), 10000);
    }
}

// Validar se candidatura pode ser enviada
function validarCandidaturaPodeSerEnviada() {
    if (!estadoSistema.eleicaoAberta) {
        mostrarMensagem("❌ SISTEMA FECHADO: As candidaturas não estão sendo aceitas no momento.", "erro");
        return false;
    }
    
    if (!estadoSistema.tipoEleicaoAtual) {
        mostrarMensagem("⚠️ Tipo de eleição não definido pelo TSE", "aviso");
        return false;
    }
    
    return true;
}

// ============================================
// ESTILOS PARA O SISTEMA DE NOTIFICAÇÃO
// ============================================
const estilosNotificacao = document.createElement('style');
estilosNotificacao.textContent = `
.notificacao-sistema {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    background: linear-gradient(135deg, rgba(10, 15, 35, 0.95), rgba(5, 10, 25, 0.95));
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 15px;
    padding: 20px;
    min-width: 350px;
    max-width: 400px;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.4),
        0 0 100px rgba(0, 255, 136, 0.2);
    animation: slideInRight 0.5s ease;
    backdrop-filter: blur(10px);
}

.notificacao-conteudo {
    display: flex;
    align-items: flex-start;
    gap: 15px;
}

.notificacao-conteudo i {
    color: #00ff88;
    font-size: 24px;
    margin-top: 2px;
}

.notificacao-conteudo div {
    flex: 1;
}

.notificacao-conteudo strong {
    color: #00ff88;
    font-size: 16px;
    margin-bottom: 5px;
    display: block;
}

.notificacao-conteudo p {
    color: #b8b8d1;
    font-size: 14px;
    margin: 0;
}

.notificacao-fechar {
    background: transparent;
    border: none;
    color: #b8b8d1;
    cursor: pointer;
    padding: 5px;
    transition: color 0.3s;
}

.notificacao-fechar:hover {
    color: #ff5555;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Indicador de status no dashboard */
.status-indicador {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Card especial de status */
.card-status-sistema {
    position: relative;
    overflow: hidden;
}

.card-status-sistema::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #00ff88, #00ccff);
    animation: statusPulse 2s infinite;
}

@keyframes statusPulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}
`;
document.head.appendChild(estilosNotificacao);

// ============================================
// MODIFICAÇÕES NO CÓDIGO EXISTENTE
// ============================================

// 1. Na inicialização, adicionar:
document.addEventListener('DOMContentLoaded', function() {
    // ... seu código existente ...
    
    // Inicializar sistema de eleição
    setTimeout(() => inicializarSistemaEleicao(), 1000);
    
    // Event listeners corrigidos
    document.getElementById('btnAlternarEleicao').addEventListener('click', alternarStatusEleicao);
    
    document.getElementById('selectTipoEleicao').addEventListener('change', function() {
        const novoTipo = this.value;
        if (novoTipo) {
            alterarTipoEleicao(novoTipo);
        }
    });
});

// 2. Modificar a função de envio de candidatura:
async function enviarCandidatura() {
    // Verificar se sistema está aberto
    if (!validarCandidaturaPodeSerEnviada()) {
        return;
    }
    
    // ... resto do código de envio ...
}

// 3. Adicionar verificação no formulário:
function configurarValidacaoFormulario() {
    // Verificar status ao carregar formulário
    const formCandidatura = document.getElementById('candidatura');
    if (formCandidatura) {
        const observer = new MutationObserver(() => {
            if (formCandidatura.classList.contains('ativo')) {
                const btnEnviar = document.getElementById('btnEnviarCandidatura');
                if (btnEnviar) {
                    btnEnviar.disabled = !estadoSistema.eleicaoAberta;
                    if (!estadoSistema.eleicaoAberta) {
                        btnEnviar.title = "Sistema de candidaturas fechado";
                        btnEnviar.style.opacity = "0.6";
                    }
                }
            }
        });
        observer.observe(formCandidatura, { attributes: true, attributeFilter: ['class'] });
    }
}

// 4. Adicionar indicador de status no dashboard:
function adicionarIndicadorStatusDashboard() {
    const dashboardHeader = document.querySelector('#dashboard .filtros-titulo');
    if (dashboardHeader) {
        const indicador = document.createElement('div');
        indicador.className = 'status-indicador';
        indicador.id = 'dashboardStatusIndicador';
        indicador.style.cssText = `
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 11px;
        `;
        dashboardHeader.style.position = 'relative';
        dashboardHeader.appendChild(indicador);
        atualizarIndicadoresStatus();
    }
}

// 5. Adicionar card de status no dashboard:
function adicionarCardStatusDashboard() {
    const dashboardCards = document.querySelector('.dashboard-cards');
    if (dashboardCards) {
        const cardStatus = document.createElement('div');
        cardStatus.className = 'card card-status-sistema';
        cardStatus.innerHTML = `
            <div class="card-titulo">
                <i class="fas fa-satellite-dish"></i>
                STATUS DO SISTEMA
            </div>
            <div class="card-valor" id="cardStatusValor">
                ${estadoSistema.eleicaoAberta ? 'ONLINE' : 'OFFLINE'}
            </div>
            <div class="card-detalhe" id="cardStatusDetalhe">
                ${estadoSistema.tipoEleicaoAtual ? 
                    `Tipo: ${estadoSistema.tipoEleicaoAtual === 'municipal' ? 'Eleição Municipal' : 'Eleição Federal'}` : 
                    'Tipo não definido'}
            </div>
            <div class="card-detalhe mt-10">
                <small>Atualizado: ${new Date().toLocaleTimeString()}</small>
            </div>
        `;
        dashboardCards.insertBefore(cardStatus, dashboardCards.firstChild);
    }
}

// 6. Atualizar periodicamente o status
function iniciarAtualizacaoPeriodica() {
    setInterval(() => {
        if (estadoSistema.eleicaoAberta) {
            const cardValor = document.getElementById('cardStatusValor');
            const cardDetalhe = document.getElementById('cardStatusDetalhe');
            if (cardValor) cardValor.textContent = 'ONLINE';
            if (cardDetalhe) {
                cardDetalhe.textContent = estadoSistema.tipoEleicaoAtual ? 
                    `Tipo: ${estadoSistema.tipoEleicaoAtual === 'municipal' ? 'Eleição Municipal' : 'Eleição Federal'}` : 
                    'Tipo não definido';
            }
        }
    }, 30000); // Atualizar a cada 30 segundos
}

// ============================================
// FUNÇÃO DE RESET DE SISTEMA (APENAS TSE)
// ============================================
async function resetarSistemaEleicao() {
    if (!confirm("⚠️ ATENÇÃO: Isso irá resetar todo o sistema de eleição. Tem certeza?")) {
        return;
    }
    
    if (!estadoSistema.usuarioAutenticado || estadoSistema.tipoUsuario !== 'tse') {
        mostrarMensagem("❌ Apenas o TSE pode resetar o sistema", "erro");
        return;
    }
    
    try {
        // Resetar configuração
        await configEleicaoRef.update({
            eleicaoAberta: false,
            tipoEleicao: null,
            ultimaAtualizacao: new Date().toISOString(),
            atualizadoPor: estadoSistema.usuarioInfo.nome,
            reset: {
                data: new Date().toISOString(),
                usuario: estadoSistema.usuarioInfo.nome,
                motivo: "Reset manual pelo TSE"
            }
        });
        
        // Atualizar estado local
        estadoSistema.eleicaoAberta = false;
        estadoSistema.tipoEleicaoAtual = null;
        
        atualizarStatusEleicaoUI();
        
        mostrarMensagem("🔄 Sistema resetado com sucesso!", "sucesso");
        
    } catch (error) {
        console.error("❌ Erro ao resetar sistema:", error);
        mostrarMensagem("Erro ao resetar sistema", "erro");
    }
}

// ============================================
// ADICIONAR BOTÃO DE RESET NA INTERFACE TSE
// ============================================
function adicionarControleReset() {
    const gerenciamentoContent = document.getElementById('conteudoGerenciamento');
    if (gerenciamentoContent && estadoSistema.tipoUsuario === 'tse') {
        // Adicionar botão de reset
        const resetButton = document.createElement('button');
        resetButton.className = 'btn btn-pequeno';
        resetButton.style.cssText = `
            background: linear-gradient(135deg, #ff5555, #ff0000);
            color: white;
            margin-left: 10px;
        `;
        resetButton.innerHTML = '<i class="fas fa-redo"></i> Resetar Sistema';
        resetButton.addEventListener('click', resetarSistemaEleicao);
        
        // Encontrar o card de status e adicionar o botão
        const statusCard = document.querySelector('.card .card-detalhe');
        if (statusCard) {
            statusCard.appendChild(resetButton);
        }
    }
}

// ============================================
// INICIALIZAÇÃO COMPLETA
// ============================================
function inicializarSistemaCompleto() {
    console.log("🚀 Iniciando sistema completo...");
    
    // 1. Inicializar Firebase
    inicializarFirebase();
    
    // 2. Inicializar sistema de eleição
    inicializarSistemaEleicao();
    
    // 3. Configurar validação do formulário
    configurarValidacaoFormulario();
    
    // 4. Adicionar indicadores no dashboard
    adicionarIndicadorStatusDashboard();
    adicionarCardStatusDashboard();
    
    // 5. Iniciar atualização periódica
    iniciarAtualizacaoPeriodica();
    
    // 6. Verificar se é TSE para adicionar controles extras
    if (estadoSistema.tipoUsuario === 'tse') {
        adicionarControleReset();
    }
    
    console.log("✅ Sistema inicializado com sucesso!");
}

// Chame esta função no DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    // Seu código existente...
    
    // Depois de tudo carregado
    setTimeout(() => inicializarSistemaCompleto(), 2000);
});

// ============================================
// DEBUG E LOGS DO SISTEMA
// ============================================
function mostrarLogsSistema() {
    console.log("=== SISTEMA DE ELEIÇÃO ===");
    console.log("Status:", estadoSistema.eleicaoAberta ? "ONLINE" : "OFFLINE");
    console.log("Tipo:", estadoSistema.tipoEleicaoAtual || "Não definido");
    console.log("Usuário:", estadoSistema.usuarioInfo?.nome || "Não autenticado");
    console.log("Tipo Usuário:", estadoSistema.tipoUsuario || "Nenhum");
    console.log("========================");
}

// Adicionar botão de debug (apenas desenvolvimento)
if (window.location.hostname === 'localhost') {
    const debugBtn = document.createElement('button');
    debugBtn.textContent = "🔧 Debug Sistema";
    debugBtn.style.cssText = `
        position: fixed;
        bottom: 10px;
        right: 10px;
        z-index: 9999;
        padding: 10px;
        background: #333;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    `;
    debugBtn.addEventListener('click', mostrarLogsSistema);
    document.body.appendChild(debugBtn);
}

        function carregarDadosIniciais() {
            // Carregar estados
            DADOS_SISTEMA.estados.forEach(estado => {
                const option = document.createElement('option');
                option.value = estado.nome;
                option.textContent = estado.nome;
                
                ['candidatoEstado', 'filtroEstado', 'treEstado'].forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        const newOption = option.cloneNode(true);
                        select.appendChild(newOption);
                    }
                });
            });

            // Carregar cargos
            const todosCargos = [
                ...DADOS_SISTEMA.tiposEleicao.municipal.cargos,
                ...DADOS_SISTEMA.tiposEleicao.federal.cargos
            ];

            todosCargos.forEach(cargo => {
                const option = document.createElement('option');
                option.value = cargo.nome;
                option.textContent = `${cargo.nome} (${cargo.digitos} dígitos)`;
                
                ['candidatoCargo', 'filtroCargo'].forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        const newOption = option.cloneNode(true);
                        select.appendChild(newOption);
                    }
                });
            });

            // Carregar partidos no filtro
            const selectFiltroPartido = document.getElementById('filtroPartido');
            Object.values(DADOS_SISTEMA.partidos).flat().forEach(partido => {
                const option = document.createElement('option');
                option.value = partido.sigla;
                option.textContent = `${partido.sigla} (${partido.numero})`;
                selectFiltroPartido.appendChild(option);
            });

            preencherTabelaPartidos();
        }

        // Configurar Event Listeners
        function configurarEventListeners() {
            // Navegação entre abas
            document.querySelectorAll('.aba-item').forEach(aba => {
                aba.addEventListener('click', function() {
                    const abaId = this.getAttribute('data-aba');
                    navegarParaAba(abaId);
                });
            });

            // Login options
            document.querySelectorAll('.login-opcao').forEach(opcao => {
                opcao.addEventListener('click', function() {
                    const tipo = this.getAttribute('data-tipo');
                    
                    document.querySelectorAll('.login-opcao').forEach(o => {
                        o.classList.remove('ativo');
                    });
                    
                    this.classList.add('ativo');
                    
                    if (tipo === 'tse') {
                        document.getElementById('formLoginTSE').classList.remove('hidden');
                        document.getElementById('formLoginTRE').classList.add('hidden');
                    } else {
                        document.getElementById('formLoginTSE').classList.add('hidden');
                        document.getElementById('formLoginTRE').classList.remove('hidden');
                    }
                });
            });

            // Botões de login
            document.getElementById('btnLoginTSE').addEventListener('click', fazerLoginTSE);
            document.getElementById('btnLoginTRE').addEventListener('click', fazerLoginTRE);

            // Foto do candidato
            document.getElementById('candidatoFoto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Validar tamanho (máx 2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        mostrarMensagem("A foto deve ter no máximo 2MB", "erro");
                        this.value = '';
                        return;
                    }
                    
                    // Validar tipo
                    if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                        mostrarMensagem("Apenas imagens JPG e PNG são permitidas", "erro");
                        this.value = '';
                        return;
                    }
                    
                    estadoSistema.fotoFile = file;
                    
                    // Mostrar preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('fotoPreview');
                        preview.src = e.target.result;
                        preview.classList.remove('hidden');
                        preview.previousElementSibling.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Etapa 1: Validação em tempo real
            document.getElementById('candidatoEstado').addEventListener('change', function() {
                const estadoSelecionado = this.value;
                const selectCidade = document.getElementById('candidatoCidade');
                
                selectCidade.innerHTML = '<option value="">Cidade</option>';
                selectCidade.disabled = !estadoSelecionado;
                
                if (estadoSelecionado) {
                    const estado = DADOS_SISTEMA.estados.find(e => e.nome === estadoSelecionado);
                    if (estado) {
                        estado.cidades.forEach(cidade => {
                            const option = document.createElement('option');
                            option.value = cidade;
                            option.textContent = cidade;
                            selectCidade.appendChild(option);
                        });
                    }
                }
                validarEtapa1();
            });

            document.getElementById('candidatoIdeologia').addEventListener('change', function() {
                const ideologiaSelecionada = this.value;
                const selectPartido = document.getElementById('candidatoPartido');
                const selectColigacao = document.getElementById('coligacaoPartido');
                
                selectPartido.innerHTML = '<option value="">Selecione um partido</option>';
                selectColigacao.innerHTML = '<option value="">Adicionar partido à coligação</option>';
                
                if (ideologiaSelecionada && DADOS_SISTEMA.partidos[ideologiaSelecionada]) {
                    const partidosOrdenados = [...DADOS_SISTEMA.partidos[ideologiaSelecionada]].sort((a, b) => a.numero - b.numero);
                    
                    partidosOrdenados.forEach(partido => {
                        const option = document.createElement('option');
                        option.value = partido.sigla;
                        option.textContent = `${partido.sigla} (${partido.numero}) - ${partido.nome}`;
                        selectPartido.appendChild(option);
                        
                        const option2 = option.cloneNode(true);
                        selectColigacao.appendChild(option2);
                    });
                }
                
                validarEtapa1();
            });

            document.getElementById('candidatoCargo').addEventListener('change', function() {
                validarEtapa1();
                // Mostrar/ocultar coligação baseado no cargo
                const cargoSelecionado = this.value;
                const coligacaoContainer = document.getElementById('coligacaoContainer');
                
                if (cargoSelecionado) {
                    // Encontrar quantos dígitos tem o cargo
                    let digitosCargo = 0;
                    for (const tipo in DADOS_SISTEMA.tiposEleicao) {
                        const cargoInfo = DADOS_SISTEMA.tiposEleicao[tipo].cargos.find(c => c.nome === cargoSelecionado);
                        if (cargoInfo) {
                            digitosCargo = cargoInfo.digitos;
                            break;
                        }
                    }
                    
                    // Coligação apenas para cargos de 2 dígitos (majoritários)
                    if (digitosCargo === 2) {
                        coligacaoContainer.classList.remove('hidden');
                    } else {
                        coligacaoContainer.classList.add('hidden');
                        estadoSistema.coligacao = [];
                        atualizarListaColigacao();
                    }
                }
            });

            // Validação dos campos da etapa 1
            ['candidatoNome', 'candidatoSobrenome', 'candidatoTiktok', 'candidatoCidade'].forEach(id => {
                document.getElementById(id).addEventListener('input', validarEtapa1);
            });

            // Botão etapa 1
            document.getElementById('btnEtapa1').addEventListener('click', avancarParaEtapa2);

            // Etapa 2: Número de candidatura
            document.getElementById('candidatoPartido').addEventListener('change', function() {
                const partidoSelecionado = this.value;
                const cargoSelecionado = document.getElementById('candidatoCargo').value;
                
                if (partidoSelecionado && cargoSelecionado) {
                    // Encontrar o partido selecionado
                    let partidoInfo = null;
                    for (const ideologia in DADOS_SISTEMA.partidos) {
                        const partido = DADOS_SISTEMA.partidos[ideologia].find(p => p.sigla === partidoSelecionado);
                        if (partido) {
                            partidoInfo = partido;
                            break;
                        }
                    }
                    
                    if (partidoInfo) {
                        // Gerar número base
                        const numeroBase = partidoInfo.numero.toString().padStart(2, '0');
                        
                        // Encontrar quantos dígitos tem o cargo
                        let digitosCargo = 0;
                        for (const tipo in DADOS_SISTEMA.tiposEleicao) {
                            const cargoInfo = DADOS_SISTEMA.tiposEleicao[tipo].cargos.find(c => c.nome === cargoSelecionado);
                            if (cargoInfo) {
                                digitosCargo = cargoInfo.digitos;
                                break;
                            }
                        }
                        
                        // Se for cargo de 2 dígitos, usar apenas o número do partido
                        let numeroCompleto = numeroBase;
                        if (digitosCargo > 2) {
                            // Gerar dígitos extras aleatórios
                            for (let i = 0; i < (digitosCargo - 2); i++) {
                                numeroCompleto += Math.floor(Math.random() * 10);
                            }
                        }
                        
                        document.getElementById('candidatoNumero').value = numeroCompleto;
                        document.getElementById('candidatoNumero').maxLength = digitosCargo;
                        
                        // Validar o número
                        validarNumeroCandidatura(numeroCompleto, cargoSelecionado);
                    }
                }
                
                validarEtapa2();
            });

            document.getElementById('candidatoNumero').addEventListener('input', function() {
                const numero = this.value;
                const cargo = document.getElementById('candidatoCargo').value;
                
                if (numero && cargo) {
                    validarNumeroCandidatura(numero, cargo);
                }
                
                validarEtapa2();
            });

            // Coligação
            document.getElementById('btnAddColigacao').addEventListener('click', function() {
                const selectColigacao = document.getElementById('coligacaoPartido');
                const partidoSelecionado = selectColigacao.value;
                
                if (!partidoSelecionado) {
                    mostrarMensagem("Selecione um partido para adicionar à coligação", "aviso");
                    return;
                }
                
                // Verificar se já está na coligação
                if (estadoSistema.coligacao.includes(partidoSelecionado)) {
                    mostrarMensagem("Este partido já está na coligação", "aviso");
                    return;
                }
                
                // Verificar se é o partido principal
                const partidoPrincipal = document.getElementById('candidatoPartido').value;
                if (partidoSelecionado === partidoPrincipal) {
                    mostrarMensagem("O partido principal não pode ser adicionado à coligação", "erro");
                    return;
                }
                
                estadoSistema.coligacao.push(partidoSelecionado);
                atualizarListaColigacao();
                selectColigacao.value = "";
            });

            // Botões das etapas
            document.getElementById('btnVoltarEtapa2').addEventListener('click', voltarParaEtapa1);
            document.getElementById('btnEtapa2').addEventListener('click', avancarParaEtapa3);
            document.getElementById('btnVoltarEtapa3').addEventListener('click', voltarParaEtapa2);
            document.getElementById('btnEtapa3').addEventListener('click', avancarParaEtapa4);
            document.getElementById('btnVoltarEtapa4').addEventListener('click', voltarParaEtapa3);
            document.getElementById('btnEnviarCandidatura').addEventListener('click', enviarCandidatura);

            // Filtros
            document.getElementById('filtroEstado').addEventListener('change', function() {
                const estadoSelecionado = this.value;
                const selectCidade = document.getElementById('filtroCidade');
                
                selectCidade.innerHTML = '<option value="">Todas as cidades</option>';
                selectCidade.disabled = !estadoSelecionado;
                
                if (estadoSelecionado) {
                    const estado = DADOS_SISTEMA.estados.find(e => e.nome === estadoSelecionado);
                    if (estado) {
                        estado.cidades.forEach(cidade => {
                            const option = document.createElement('option');
                            option.value = cidade;
                            option.textContent = cidade;
                            selectCidade.appendChild(option);
                        });
                    }
                }
                
                atualizarTabelaCandidatos();
            });

            document.querySelectorAll('#filtroCidade, #filtroCargo, #filtroPartido, #filtroStatus').forEach(select => {
                select.addEventListener('change', atualizarTabelaCandidatos);
            });

            document.getElementById('toggleRecusados').addEventListener('change', atualizarTabelaCandidatos);

            // Filtro de análise
            document.getElementById('filtroStatusAnalise').addEventListener('change', atualizarTabelaAnalise);

            // Gerenciamento TSE
            document.getElementById('btnAlternarEleicao').addEventListener('click', alternarStatusEleicao);
            document.getElementById('selectTipoEleicao').addEventListener('change', async function() {
                estadoSistema.tipoEleicaoAtual = this.value;
                await salvarConfiguracaoFirebase();
                atualizarStatusEleicaoUI();
            });

            // Busca para exclusão
            document.getElementById('btnBuscarExclusao').addEventListener('click', buscarCandidaturasParaExclusao);
            document.getElementById('filtroExclusao').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    buscarCandidaturasParaExclusao();
                }
            });

            // Modais
            document.getElementById('btnFecharModal').addEventListener('click', function() {
                document.getElementById('modalDetalhes').classList.remove('ativo');
            });
            
            document.getElementById('btnCancelarAnalise').addEventListener('click', function() {
                document.getElementById('modalAnalise').classList.remove('ativo');
                candidaturaEmAnalise = null;
            });
            
            document.getElementById('btnAprovarCandidatura').addEventListener('click', aprovarCandidatura);
            document.getElementById('btnRecusarCandidatura').addEventListener('click', recusarCandidatura);
            
            document.getElementById('btnCancelarExclusao').addEventListener('click', function() {
                document.getElementById('modalExclusao').classList.remove('ativo');
                candidaturaParaExcluir = null;
            });
            
            document.getElementById('btnConfirmarExclusao').addEventListener('click', confirmarExclusao);

            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('ativo');
                        candidaturaEmAnalise = null;
                        candidaturaParaExcluir = null;
                    }
                });
            });
        }

        // Funções de Validação
        function validarEtapa1() {
            const campos = {
                nome: document.getElementById('candidatoNome').value.trim(),
                sobrenome: document.getElementById('candidatoSobrenome').value.trim(),
                tiktok: document.getElementById('candidatoTiktok').value.trim(),
                ideologia: document.getElementById('candidatoIdeologia').value,
                cargo: document.getElementById('candidatoCargo').value,
                estado: document.getElementById('candidatoEstado').value,
                cidade: document.getElementById('candidatoCidade').value,
                foto: estadoSistema.fotoFile
            };
            
            const valido = campos.nome && 
                         campos.sobrenome && 
                         campos.tiktok && 
                         campos.tiktok.includes('@') &&
                         campos.ideologia &&
                         campos.cargo &&
                         campos.estado &&
                         campos.cidade &&
                         campos.foto;
            
            document.getElementById('btnEtapa1').disabled = !valido;
            
            if (valido) {
                estadoSistema.dadosCandidatura.etapa1 = campos;
            }
            
            return valido;
        }

        function validarEtapa2() {
            const partido = document.getElementById('candidatoPartido').value;
            const numero = document.getElementById('candidatoNumero').value;
            const validacao = document.getElementById('validacaoNumero');
            
            const valido = partido && 
                         numero && 
                         !validacao.classList.contains('invalid');
            
            document.getElementById('btnEtapa2').disabled = !valido;
            
            if (valido) {
                estadoSistema.dadosCandidatura.etapa2 = {
                    partido,
                    numero,
                    coligacao: [...estadoSistema.coligacao]
                };
            }
            
            return valido;
        }

        async function validarNumeroCandidatura(numero, cargo) {
            const validacao = document.getElementById('validacaoNumero');
            
            // Encontrar quantos dígitos deve ter
            let digitosEsperados = 0;
            for (const tipo in DADOS_SISTEMA.tiposEleicao) {
                const cargoInfo = DADOS_SISTEMA.tiposEleicao[tipo].cargos.find(c => c.nome === cargo);
                if (cargoInfo) {
                    digitosEsperados = cargoInfo.digitos;
                    break;
                }
            }
            
            // Validar comprimento
            if (numero.length !== digitosEsperados) {
                validacao.innerHTML = `<i class="fas fa-times-circle"></i> O número deve ter ${digitosEsperados} dígitos`;
                validacao.className = 'numero-validacao invalid';
                return false;
            }
            
            // Validar que os dois primeiros dígitos não mudaram
            const partidoSelecionado = document.getElementById('candidatoPartido').value;
            if (partidoSelecionado) {
                // Encontrar número do partido
                let numeroPartido = null;
                for (const ideologia in DADOS_SISTEMA.partidos) {
                    const partido = DADOS_SISTEMA.partidos[ideologia].find(p => p.sigla === partidoSelecionado);
                    if (partido) {
                        numeroPartido = partido.numero.toString().padStart(2, '0');
                        break;
                    }
                }
                
                if (numeroPartido && !numero.startsWith(numeroPartido)) {
                    validacao.innerHTML = `<i class="fas fa-times-circle"></i> Os dois primeiros dígitos devem ser ${numeroPartido}`;
                    validacao.className = 'numero-validacao invalid';
                    return false;
                }
            }
            
            // Verificar se o número já existe para o mesmo cargo/local
            const estado = document.getElementById('candidatoEstado').value;
            const cidade = document.getElementById('candidatoCidade').value;
            
            const numeroDuplicado = estadoSistema.candidaturas.some(c => 
                c.numero === numero && 
                c.cargo === cargo &&
                c.estado === estado &&
                (cargo === "Prefeito" || cargo === "Vereador" ? c.cidade === cidade : true)
            );
            
            if (numeroDuplicado) {
                validacao.innerHTML = `<i class="fas fa-times-circle"></i> Este número já está em uso para este cargo/local`;
                validacao.className = 'numero-validacao invalid';
                return false;
            }
            
            validacao.innerHTML = `<i class="fas fa-check-circle"></i> Número válido`;
            validacao.className = 'numero-validacao valid';
            return true;
        }

        // Funções de Navegação
        function navegarParaAba(abaId) {
            // Atualizar abas
            document.querySelectorAll('.aba-item').forEach(aba => {
                aba.classList.remove('ativo');
            });
            document.querySelector(`.aba-item[data-aba="${abaId}"]`).classList.add('ativo');
            
            // Atualizar conteúdo
            document.querySelectorAll('.aba-conteudo').forEach(conteudo => {
                conteudo.classList.remove('ativo');
            });
            document.getElementById(abaId).classList.add('ativo');
            
            // Ações específicas por aba
            switch(abaId) {
                case 'dashboard':
                    atualizarDashboard();
                    break;
                case 'analise':
                    if (!estadoSistema.usuarioAutenticado) {
                        document.getElementById('tabelaAnaliseContainer').classList.add('hidden');
                        document.getElementById('mensagemAnalise').classList.remove('hidden');
                    } else {
                        document.getElementById('tabelaAnaliseContainer').classList.remove('hidden');
                        document.getElementById('mensagemAnalise').classList.add('hidden');
                        atualizarTabelaAnalise();
                    }
                    break;
                case 'gerenciamento':
                    if (estadoSistema.tipoUsuario !== 'tse') {
                        document.getElementById('conteudoGerenciamento').classList.add('hidden');
                        document.getElementById('mensagemGerenciamento').classList.remove('hidden');
                    } else {
                        document.getElementById('conteudoGerenciamento').classList.remove('hidden');
                        document.getElementById('mensagemGerenciamento').classList.add('hidden');
                        atualizarStatusEleicaoUI();
                    }
                    break;
            }
        }

        // Funções do Formulário
        function avancarParaEtapa2() {
            if (validarEtapa1()) {
                // Atualizar etapas
                document.querySelectorAll('.etapa').forEach(etapa => {
                    etapa.classList.remove('ativo', 'concluido');
                });
                document.querySelector('.etapa[data-etapa="1"]').classList.add('concluido');
                document.querySelector('.etapa[data-etapa="2"]').classList.add('ativo');
                
                // Mostrar etapa 2
                document.getElementById('etapa1').classList.add('hidden');
                document.getElementById('etapa2').classList.remove('hidden');
                
                estadoSistema.etapaAtual = 2;
            }
        }

        function voltarParaEtapa1() {
            document.querySelectorAll('.etapa').forEach(etapa => {
                etapa.classList.remove('ativo', 'concluido');
            });
            document.querySelector('.etapa[data-etapa="1"]').classList.add('ativo');
            
            document.getElementById('etapa2').classList.add('hidden');
            document.getElementById('etapa1').classList.remove('hidden');
            
            estadoSistema.etapaAtual = 1;
        }

        function avancarParaEtapa3() {
            if (validarEtapa2()) {
                document.querySelectorAll('.etapa').forEach(etapa => {
                    etapa.classList.remove('ativo', 'concluido');
                });
                document.querySelector('.etapa[data-etapa="1"]').classList.add('concluido');
                document.querySelector('.etapa[data-etapa="2"]').classList.add('concluido');
                document.querySelector('.etapa[data-etapa="3"]').classList.add('ativo');
                
                document.getElementById('etapa2').classList.add('hidden');
                document.getElementById('etapa3').classList.remove('hidden');
                
                estadoSistema.etapaAtual = 3;
                prepararEtapa3();
            }
        }

        function prepararEtapa3() {
            const cargo = estadoSistema.dadosCandidatura.etapa1.cargo;
            const conteudoEtapa3 = document.getElementById('conteudoEtapa3');
            
            const cargosComVice = ["Presidente", "Governador", "Prefeito"];
            const cargosComSuplente = ["Senador"];
            
            if (cargosComVice.includes(cargo)) {
                conteudoEtapa3.innerHTML = `
                    <div class="form-grid">
                        <div class="filtro-group">
                            <label class="filtro-label">
                                <i class="fas fa-user"></i>
                                Vice
                            </label>
                            <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                                <input type="text" class="form-input" id="viceNome" placeholder="Nome" required>
                                <input type="text" class="form-input" id="viceSobrenome" placeholder="Sobrenome" required>
                            </div>
                            <input type="text" class="form-input mt-10" id="viceTiktok" placeholder="@usuariovice (opcional)">
                        </div>
                    </div>
                `;
                
                // Validar em tempo real
                document.getElementById('viceNome').addEventListener('input', validarEtapa3);
                document.getElementById('viceSobrenome').addEventListener('input', validarEtapa3);
                
            } else if (cargosComSuplente.includes(cargo)) {
                conteudoEtapa3.innerHTML = `
                    <div class="form-grid">
                        <div class="filtro-group">
                            <label class="filtro-label">
                                <i class="fas fa-user"></i>
                                Suplente
                            </label>
                            <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                                <input type="text" class="form-input" id="suplenteNome" placeholder="Nome" required>
                                <input type="text" class="form-input" id="suplenteSobrenome" placeholder="Sobrenome" required>
                            </div>
                            <input type="text" class="form-input mt-10" id="suplenteTiktok" placeholder="@usuariosuplente (opcional)">
                        </div>
                    </div>
                `;
                
                // Validar em tempo real
                document.getElementById('suplenteNome').addEventListener('input', validarEtapa3);
                document.getElementById('suplenteSobrenome').addEventListener('input', validarEtapa3);
                
            } else {
                conteudoEtapa3.innerHTML = `
                    <div class="mensagem mensagem-aviso">
                        <i class="fas fa-info-circle"></i>
                        <div>Não é necessário registrar vice ou suplente para este cargo.</div>
                    </div>
                `;
                document.getElementById('btnEtapa3').disabled = false;
                return;
            }
            
            validarEtapa3();
        }

        function validarEtapa3() {
            const cargo = estadoSistema.dadosCandidatura.etapa1.cargo;
            const cargosComVice = ["Presidente", "Governador", "Prefeito"];
            const cargosComSuplente = ["Senador"];
            
            let valido = true;
            
            if (cargosComVice.includes(cargo)) {
                const viceNome = document.getElementById('viceNome')?.value.trim();
                const viceSobrenome = document.getElementById('viceSobrenome')?.value.trim();
                const viceTiktok = document.getElementById('viceTiktok')?.value.trim() || "";
                
                valido = viceNome && viceSobrenome;
                
                if (valido) {
                    estadoSistema.dadosCandidatura.etapa3 = {
                        vice: { nome: viceNome, sobrenome: viceSobrenome, tiktok: viceTiktok }
                    };
                }
            } else if (cargosComSuplente.includes(cargo)) {
                const suplenteNome = document.getElementById('suplenteNome')?.value.trim();
                const suplenteSobrenome = document.getElementById('suplenteSobrenome')?.value.trim();
                const suplenteTiktok = document.getElementById('suplenteTiktok')?.value.trim() || "";
                
                valido = suplenteNome && suplenteSobrenome;
                
                if (valido) {
                    estadoSistema.dadosCandidatura.etapa3 = {
                        suplente: { nome: suplenteNome, sobrenome: suplenteSobrenome, tiktok: suplenteTiktok }
                    };
                }
            }
            
            document.getElementById('btnEtapa3').disabled = !valido;
            return valido;
        }

        function voltarParaEtapa2() {
            document.querySelectorAll('.etapa').forEach(etapa => {
                etapa.classList.remove('ativo', 'concluido');
            });
            document.querySelector('.etapa[data-etapa="1"]').classList.add('concluido');
            document.querySelector('.etapa[data-etapa="2"]').classList.add('ativo');
            
            document.getElementById('etapa3').classList.add('hidden');
            document.getElementById('etapa2').classList.remove('hidden');
            
            estadoSistema.etapaAtual = 2;
        }

        function avancarParaEtapa4() {
            if (validarEtapa3()) {
                document.querySelectorAll('.etapa').forEach(etapa => {
                    etapa.classList.remove('ativo', 'concluido');
                });
                document.querySelector('.etapa[data-etapa="1"]').classList.add('concluido');
                document.querySelector('.etapa[data-etapa="2"]').classList.add('concluido');
                document.querySelector('.etapa[data-etapa="3"]').classList.add('concluido');
                document.querySelector('.etapa[data-etapa="4"]').classList.add('ativo');
                
                document.getElementById('etapa3').classList.add('hidden');
                document.getElementById('etapa4').classList.remove('hidden');
                
                estadoSistema.etapaAtual = 4;
                prepararResumoCandidatura();
            }
        }

        function prepararResumoCandidatura() {
            const dados = estadoSistema.dadosCandidatura;
            const resumo = document.getElementById('resumoCandidatura');
            
            // Encontrar informações do partido
            let partidoInfo = null;
            Object.values(DADOS_SISTEMA.partidos).flat().some(partido => {
                if (partido.sigla === dados.etapa2.partido) {
                    partidoInfo = partido;
                    return true;
                }
                return false;
            });
            
            let html = `
                <div class="form-grid">
                    <div class="filtro-group">
                        <label class="filtro-label">Candidato:</label>
                        <div><strong>${dados.etapa1.nome} ${dados.etapa1.sobrenome}</strong></div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">TikTok:</label>
                        <div>${dados.etapa1.tiktok}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Cargo:</label>
                        <div>${dados.etapa1.cargo}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Local:</label>
                        <div>${dados.etapa1.cidade} - ${dados.etapa1.estado}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Partido:</label>
                        <div>${partidoInfo ? `${partidoInfo.sigla} (${partidoInfo.numero}) - ${partidoInfo.nome}` : dados.etapa2.partido}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Número:</label>
                        <div><strong class="card-valor">${dados.etapa2.numero}</strong></div>
                    </div>
                </div>
            `;
            
            // Coligação
            if (dados.etapa2.coligacao && dados.etapa2.coligacao.length > 0) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Coligação:</h4>
                        <div class="form-grid">
                `;
                
                dados.etapa2.coligacao.forEach(sigla => {
                    // Encontrar informações do partido da coligação
                    let partidoColigacao = null;
                    Object.values(DADOS_SISTEMA.partidos).flat().some(partido => {
                        if (partido.sigla === sigla) {
                            partidoColigacao = partido;
                            return true;
                        }
                        return false;
                    });
                    
                    if (partidoColigacao) {
                        html += `
                            <div class="filtro-group">
                                <div>${partidoColigacao.sigla} (${partidoColigacao.numero})</div>
                            </div>
                        `;
                    }
                });
                
                html += `</div></div>`;
            }
            
            // Vice/Suplente
            if (dados.etapa3.vice) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Vice:</h4>
                        <div class="form-grid">
                            <div class="filtro-group">
                                <label class="filtro-label">Nome:</label>
                                <div>${dados.etapa3.vice.nome} ${dados.etapa3.vice.sobrenome}</div>
                            </div>
                            <div class="filtro-group">
                                <label class="filtro-label">TikTok:</label>
                                <div>${dados.etapa3.vice.tiktok || "Não informado"}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (dados.etapa3.suplente) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Suplente:</h4>
                        <div class="form-grid">
                            <div class="filtro-group">
                                <label class="filtro-label">Nome:</label>
                                <div>${dados.etapa3.suplente.nome} ${dados.etapa3.suplente.sobrenome}</div>
                            </div>
                            <div class="filtro-group">
                                <label class="filtro-label">TikTok:</label>
                                <div>${dados.etapa3.suplente.tiktok || "Não informado"}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            resumo.innerHTML = html;
        }

        function voltarParaEtapa3() {
            document.querySelectorAll('.etapa').forEach(etapa => {
                etapa.classList.remove('ativo', 'concluido');
            });
            document.querySelector('.etapa[data-etapa="1"]').classList.add('concluido');
            document.querySelector('.etapa[data-etapa="2"]').classList.add('concluido');
            document.querySelector('.etapa[data-etapa="3"]').classList.add('ativo');
            
            document.getElementById('etapa4').classList.add('hidden');
            document.getElementById('etapa3').classList.remove('hidden');
            
            estadoSistema.etapaAtual = 3;
        }

        async function enviarCandidatura() {
            try {
                // Verificar se o sistema está aberto
                if (!estadoSistema.eleicaoAberta) {
                    mostrarMensagem("O sistema eleitoral está fechado. Aguarde a abertura das inscrições.", "erro");
                    return;
                }
                
                const dados = estadoSistema.dadosCandidatura;
                
                // Upload da foto
                let fotoUrl = "";
                if (estadoSistema.fotoFile) {
                    mostrarMensagem("Enviando foto...", "aviso");
                    fotoUrl = await uploadFoto(estadoSistema.fotoFile);
                }
                
                // Preparar objeto da candidatura
                const candidatura = {
                    nome: dados.etapa1.nome,
                    sobrenome: dados.etapa1.sobrenome,
                    fotoUrl: fotoUrl,
                    tiktok: dados.etapa1.tiktok,
                    ideologia: dados.etapa1.ideologia,
                    cargo: dados.etapa1.cargo,
                    estado: dados.etapa1.estado,
                    cidade: dados.etapa1.cidade,
                    partido: dados.etapa2.partido,
                    numero: dados.etapa2.numero,
                    coligacao: dados.etapa2.coligacao || [],
                    vice: dados.etapa3.vice || null,
                    suplente: dados.etapa3.suplente || null,
                    status: "analise",
                    motivoRecusa: "",
                    dataRegistro: new Date().toISOString(),
                    dataAtualizacao: new Date().toISOString()
                };
                
                // Salvar no Firebase
                mostrarMensagem("Salvando candidatura...", "aviso");
                await salvarCandidaturaFirebase(candidatura);
                
                // Resetar formulário
                resetarFormularioCandidatura();
                
                // Mostrar mensagem de sucesso
                mostrarMensagem("✅ Candidatura registrada com sucesso! Status: EM ANÁLISE", "sucesso");
                
                // Atualizar visualizações
                atualizarDashboard();
                atualizarTabelaCandidatos();
                
                // Voltar para dashboard
                navegarParaAba('dashboard');
                
            } catch (error) {
                console.error("❌ Erro ao enviar candidatura:", error);
                mostrarMensagem("Erro ao enviar candidatura. Tente novamente.", "erro");
            }
        }

        function resetarFormularioCandidatura() {
            // Resetar campos do formulário
            document.getElementById('candidatoNome').value = '';
            document.getElementById('candidatoSobrenome').value = '';
            document.getElementById('candidatoTiktok').value = '';
            document.getElementById('candidatoIdeologia').value = '';
            document.getElementById('candidatoCargo').value = '';
            document.getElementById('candidatoEstado').value = '';
            document.getElementById('candidatoCidade').innerHTML = '<option value="">Cidade</option>';
            document.getElementById('candidatoCidade').disabled = true;
            document.getElementById('candidatoPartido').innerHTML = '<option value="">Selecione um partido</option>';
            document.getElementById('candidatoNumero').value = '';
            document.getElementById('validacaoNumero').innerHTML = '';
            document.getElementById('validacaoNumero').className = 'numero-validacao';
            document.getElementById('candidatoFoto').value = '';
            
            // Resetar preview da foto
            document.getElementById('fotoPreview').src = '';
            document.getElementById('fotoPreview').classList.add('hidden');
            document.querySelector('.foto-placeholder').classList.remove('hidden');
            
            // Resetar coligação
            estadoSistema.coligacao = [];
            atualizarListaColigacao();
            
            // Resetar etapas
            document.querySelectorAll('.etapa').forEach(etapa => {
                etapa.classList.remove('ativo', 'concluido');
            });
            document.querySelector('.etapa[data-etapa="1"]').classList.add('ativo');
            
            document.querySelectorAll('.form-etapa-conteudo').forEach(etapa => {
                etapa.classList.add('hidden');
            });
            document.getElementById('etapa1').classList.remove('hidden');
            
            // Resetar estado
            estadoSistema.dadosCandidatura = { etapa1: {}, etapa2: {}, etapa3: {}, etapa4: {} };
            estadoSistema.fotoFile = null;
            estadoSistema.etapaAtual = 1;
        }

        function atualizarListaColigacao() {
            const lista = document.getElementById('coligacaoLista');
            lista.innerHTML = '';
            
            estadoSistema.coligacao.forEach(sigla => {
                const item = document.createElement('div');
                item.className = 'coligacao-item';
                
                // Encontrar informações do partido
                let partidoInfo = null;
                Object.values(DADOS_SISTEMA.partidos).flat().some(partido => {
                    if (partido.sigla === sigla) {
                        partidoInfo = partido;
                        return true;
                    }
                    return false;
                });
                
                item.innerHTML = `
                    <span>${sigla} (${partidoInfo ? partidoInfo.numero : '?'})</span>
                    <button type="button" class="coligacao-remove" data-sigla="${sigla}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                lista.appendChild(item);
            });
            
            // Adicionar event listeners para remover
            lista.querySelectorAll('.coligacao-remove').forEach(btn => {
                btn.addEventListener('click', function() {
                    const sigla = this.getAttribute('data-sigla');
                    estadoSistema.coligacao = estadoSistema.coligacao.filter(s => s !== sigla);
                    atualizarListaColigacao();
                });
            });
        }

        // Funções do Dashboard
        function atualizarDashboard() {
            const total = estadoSistema.candidaturas.length;
            const aprovados = estadoSistema.candidaturas.filter(c => c.status === "aprovado").length;
            const analise = estadoSistema.candidaturas.filter(c => c.status === "analise").length;
            const recusados = estadoSistema.candidaturas.filter(c => c.status === "recusado").length;
            
            document.getElementById('totalCandidatos').textContent = total;
            document.getElementById('totalAprovados').textContent = aprovados;
            document.getElementById('totalAnalise').textContent = analise;
            document.getElementById('totalRecusados').textContent = recusados;
        }

        function atualizarTabelaCandidatos() {
            const tbody = document.getElementById('tabelaCandidatos');
            tbody.innerHTML = '';
            
            const filtros = {
                estado: document.getElementById('filtroEstado').value,
                cidade: document.getElementById('filtroCidade').value,
                cargo: document.getElementById('filtroCargo').value,
                partido: document.getElementById('filtroPartido').value,
                status: document.getElementById('filtroStatus').value,
                mostrarRecusados: document.getElementById('toggleRecusados').checked
            };
            
            let candidaturasFiltradas = estadoSistema.candidaturas;
            
            // Aplicar filtros
            if (filtros.estado) {
                candidaturasFiltradas = candidaturasFiltradas.filter(c => c.estado === filtros.estado);
            }
            
            if (filtros.cidade) {
                candidaturasFiltradas = candidaturasFiltradas.filter(c => c.cidade === filtros.cidade);
            }
            
            if (filtros.cargo) {
                candidaturasFiltradas = candidaturasFiltradas.filter(c => c.cargo === filtros.cargo);
            }
            
            if (filtros.partido) {
                candidaturasFiltradas = candidaturasFiltradas.filter(c => c.partido === filtros.partido);
            }
            
            if (filtros.status) {
                candidaturasFiltradas = candidaturasFiltradas.filter(c => c.status === filtros.status);
            }
            
            // Filtrar recusados se não estiver marcado para mostrar
            if (!filtros.mostrarRecusados) {
                candidaturasFiltradas = candidaturasFiltradas.filter(c => c.status !== "recusado");
            }
            
            // Ordenar por data de registro
            candidaturasFiltradas.sort((a, b) => new Date(b.dataRegistro) - new Date(a.dataRegistro));
            
            // Preencher tabela
            if (candidaturasFiltradas.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td colspan="7" class="texto-centro" style="padding: 40px;">
                        <i class="fas fa-search" style="font-size: 24px; color: var(--silver); margin-bottom: 10px;"></i>
                        <div style="color: var(--silver);">Nenhuma candidatura encontrada</div>
                    </td>
                `;
                tbody.appendChild(tr);
                return;
            }
            
            candidaturasFiltradas.forEach(candidatura => {
                const tr = document.createElement('tr');
                
                // Determinar status
                let statusClass, statusText;
                switch(candidatura.status) {
                    case "analise":
                        statusClass = "status-analise";
                        statusText = "EM ANÁLISE";
                        break;
                    case "aprovado":
                        statusClass = "status-aprovado";
                        statusText = "APROVADO";
                        break;
                    case "recusado":
                        statusClass = "status-recusado";
                        statusText = "RECUSADO";
                        break;
                }
                
                // Coligação
                let partidoTexto = candidatura.partido;
                if (candidatura.coligacao && candidatura.coligacao.length > 0) {
                    partidoTexto += ` + ${candidatura.coligacao.join(', ')}`;
                }
                
                tr.innerHTML = `
                    <td>
                        ${candidatura.fotoUrl ? 
                            `<img src="${candidatura.fotoUrl}" class="foto-candidato-tabela" alt="Foto">` : 
                            `<div class="foto-candidato-tabela" style="background: var(--deep-blue); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user"></i>
                            </div>`
                        }
                    </td>
                    <td>
                        <strong>${candidatura.nome} ${candidatura.sobrenome}</strong><br>
                        <small>${candidatura.tiktok}</small>
                    </td>
                    <td>${candidatura.cargo}</td>
                    <td>${partidoTexto}</td>
                    <td>${candidatura.cidade}<br><small>${candidatura.estado}</small></td>
                    <td><strong>${candidatura.numero}</strong></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                `;
                
                tr.addEventListener('click', () => mostrarDetalhesCandidatura(candidatura.id));
                tr.style.cursor = 'pointer';
                
                tbody.appendChild(tr);
            });
        }

        // Funções de Autenticação
        async function fazerLoginTSE() {
            const usuario = document.getElementById('tseUsuario').value.trim();
            const senha = document.getElementById('tseSenha').value;
            
            // Verificação básica (em produção, usar Firebase Auth)
            if (usuario === "tse_admin" && senha === "Brookasil2026!") {
                estadoSistema.usuarioAutenticado = true;
                estadoSistema.tipoUsuario = "tse";
                estadoSistema.usuarioInfo = {
                    nome: "Administrador TSE",
                    cargo: "PRESIDENTE DO TSE NACIONAL"
                };
                
                document.getElementById('usuarioNome').textContent = estadoSistema.usuarioInfo.nome;
                document.getElementById('usuarioCargo').textContent = estadoSistema.usuarioInfo.cargo;
                
                mostrarMensagem("🔓 ACESSO CONCEDIDO: TSE Nacional", "sucesso");
                navegarParaAba('dashboard');
                
            } else {
                mostrarMensagem("❌ ACESSO NEGADO: Credenciais inválidas", "erro");
            }
        }

        async function fazerLoginTRE() {
            const estado = document.getElementById('treEstado').value;
            const cidade = document.getElementById('treCidade').value;
            const usuario = document.getElementById('treUsuario').value.trim();
            const senha = document.getElementById('treSenha').value;
            
            if (!estado || !cidade || !usuario || !senha) {
                mostrarMensagem("⚠️ Preencha todos os campos", "aviso");
                return;
            }
            
            // Verificação básica (em produção, usar Firebase Auth)
            const senhaEsperada = `tre_${cidade.toLowerCase().replace(/\s+/g, '_')}_2026`;
            
            if (senha === senhaEsperada) {
                estadoSistema.usuarioAutenticado = true;
                estadoSistema.tipoUsuario = "tre";
                estadoSistema.usuarioInfo = {
                    nome: usuario,
                    cargo: `PRESIDENTE DO TRE ${cidade}`,
                    estado: estado,
                    cidade: cidade
                };
                
                document.getElementById('usuarioNome').textContent = estadoSistema.usuarioInfo.nome;
                document.getElementById('usuarioCargo').textContent = estadoSistema.usuarioInfo.cargo;
                
                mostrarMensagem(`🔓 ACESSO CONCEDIDO: TRE ${cidade}`, "sucesso");
                navegarParaAba('analise');
                
            } else {
                mostrarMensagem("❌ ACESSO NEGADO: Credenciais inválidas", "erro");
            }
        }

        function verificarAutenticacao() {
            // Em produção, verificar token do Firebase Auth
            const token = localStorage.getItem('authToken');
            if (token) {
                // Verificar token com Firebase
                // Implementação real iria aqui
            }
        }

        // Funções de Análise
        function atualizarTabelaAnalise() {
            const tbody = document.getElementById('tabelaAnalise');
            tbody.innerHTML = '';
            
            const filtroStatus = document.getElementById('filtroStatusAnalise').value;
            
            let candidaturasParaAnalise = estadoSistema.candidaturas;
            
            // Filtrar por status
            if (filtroStatus !== 'todos') {
                candidaturasParaAnalise = candidaturasParaAnalise.filter(c => c.status === filtroStatus);
            }
            
            // Se for TRE, filtrar por jurisdição
            if (estadoSistema.tipoUsuario === 'tre' && estadoSistema.usuarioInfo) {
                const { estado, cidade } = estadoSistema.usuarioInfo;
                
                candidaturasParaAnalise = candidaturasParaAnalise.filter(candidatura => {
                    if (candidatura.estado !== estado) return false;
                    
                    // TRE municipal analisa apenas candidaturas da sua cidade
                    const cargosMunicipais = ["Prefeito", "Vereador"];
                    if (cargosMunicipais.includes(candidatura.cargo)) {
                        return candidatura.cidade === cidade;
                    }
                    
                    // TRE estadual analisa todas as candidaturas do estado
                    return true;
                });
            }
            
            // Ordenar: análise primeiro, depois por data
            candidaturasParaAnalise.sort((a, b) => {
                if (a.status === 'analise' && b.status !== 'analise') return -1;
                if (a.status !== 'analise' && b.status === 'analise') return 1;
                return new Date(b.dataRegistro) - new Date(a.dataRegistro);
            });
            
            if (candidaturasParaAnalise.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td colspan="8" class="texto-centro" style="padding: 40px;">
                        <i class="fas fa-clipboard-check" style="font-size: 24px; color: var(--silver); margin-bottom: 10px;"></i>
                        <div style="color: var(--silver);">Nenhuma candidatura para análise</div>
                    </td>
                `;
                tbody.appendChild(tr);
                return;
            }
            
            candidaturasParaAnalise.forEach(candidatura => {
                const tr = document.createElement('tr');
                
                // Determinar status
                let statusClass, statusText;
                switch(candidatura.status) {
                    case "analise":
                        statusClass = "status-analise";
                        statusText = "EM ANÁLISE";
                        break;
                    case "aprovado":
                        statusClass = "status-aprovado";
                        statusText = "APROVADO";
                        break;
                    case "recusado":
                        statusClass = "status-recusado";
                        statusText = "RECUSADO";
                        break;
                }
                
                // Coligação
                let partidoTexto = candidatura.partido;
                if (candidatura.coligacao && candidatura.coligacao.length > 0) {
                    partidoTexto += ` + ${candidatura.coligacao.join(', ')}`;
                }
                
                tr.innerHTML = `
                    <td>
                        ${candidatura.fotoUrl ? 
                            `<img src="${candidatura.fotoUrl}" class="foto-candidato-tabela" alt="Foto">` : 
                            `<div class="foto-candidato-tabela" style="background: var(--deep-blue); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user"></i>
                            </div>`
                        }
                    </td>
                    <td>
                        <strong>${candidatura.nome} ${candidatura.sobrenome}</strong><br>
                        <small>${candidatura.tiktok}</small>
                    </td>
                    <td>${candidatura.cargo}</td>
                    <td>${partidoTexto}</td>
                    <td>${candidatura.cidade}<br><small>${candidatura.estado}</small></td>
                    <td><strong>${candidatura.numero}</strong></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-secundario btn-pequeno" onclick="abrirModalAnalise('${candidatura.id}')">
                                ${candidatura.status === 'analise' ? 'Analisar' : 'Detalhes'}
                            </button>
                            ${estadoSistema.tipoUsuario === 'tse' ? `
                                <button class="btn btn-pequeno" 
                                        style="background: var(--warning-red); color: white;"
                                        onclick="solicitarExclusao('${candidatura.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function abrirModalAnalise(id) {
            const candidatura = estadoSistema.candidaturas.find(c => c.id === id);
            if (!candidatura) return;
            
            candidaturaEmAnalise = candidatura;
            const modal = document.getElementById('modalAnalise');
            const conteudo = document.getElementById('conteudoModalAnalise');
            
            // Encontrar informações do partido
            let partidoInfo = null;
            Object.values(DADOS_SISTEMA.partidos).flat().some(partido => {
                if (partido.sigla === candidatura.partido) {
                    partidoInfo = partido;
                    return true;
                }
                return false;
            });
            
            let html = `
                <div class="form-grid">
                    <div class="filtro-group">
                        <label class="filtro-label">Candidato:</label>
                        <div><strong>${candidatura.nome} ${candidatura.sobrenome}</strong></div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Cargo:</label>
                        <div>${candidatura.cargo}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Local:</label>
                        <div>${candidatura.cidade} - ${candidatura.estado}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Partido:</label>
                        <div>${partidoInfo ? `${partidoInfo.sigla} (${partidoInfo.numero})` : candidatura.partido}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Número:</label>
                        <div><strong>${candidatura.numero}</strong></div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Data de Registro:</label>
                        <div>${new Date(candidatura.dataRegistro).toLocaleDateString('pt-BR')}</div>
                    </div>
                </div>
            `;
            
            // Coligação
            if (candidatura.coligacao && candidatura.coligacao.length > 0) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Coligação:</h4>
                        <div class="form-grid">
                `;
                
                candidatura.coligacao.forEach(sigla => {
                    html += `<div class="filtro-group"><div>${sigla}</div></div>`;
                });
                
                html += `</div></div>`;
            }
            
            // Vice/Suplente
            if (candidatura.vice) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Vice:</h4>
                        <div class="form-grid">
                            <div class="filtro-group">
                                <div>${candidatura.vice.nome} ${candidatura.vice.sobrenome}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (candidatura.suplente) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Suplente:</h4>
                        <div class="form-grid">
                            <div class="filtro-group">
                                <div>${candidatura.suplente.nome} ${candidatura.suplente.sobrenome}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            conteudo.innerHTML = html;
            
            // Configurar botões baseado no status atual
            const btnAprovar = document.getElementById('btnAprovarCandidatura');
            const btnRecusar = document.getElementById('btnRecusarCandidatura');
            const motivoDecisao = document.getElementById('motivoDecisao');
            
            if (candidatura.status === 'analise') {
                btnAprovar.disabled = false;
                btnRecusar.disabled = false;
                motivoDecisao.disabled = false;
                motivoDecisao.value = '';
                btnRecusar.style.background = 'linear-gradient(135deg, var(--warning-red), #ff3366)';
            } else {
                btnAprovar.disabled = true;
                btnRecusar.disabled = true;
                motivoDecisao.disabled = true;
                motivoDecisao.value = candidatura.motivoRecusa || '';
                
                if (candidatura.status === 'recusado') {
                    btnRecusar.style.background = 'linear-gradient(135deg, var(--warning-red), #ff3366)';
                } else {
                    btnRecusar.style.background = 'var(--silver)';
                }
            }
            
            modal.classList.add('ativo');
        }

        async function aprovarCandidatura() {
            if (!candidaturaEmAnalise) return;
            
            const motivo = document.getElementById('motivoDecisao').value.trim();
            
            try {
                await atualizarCandidaturaFirebase(candidaturaEmAnalise.id, {
                    status: "aprovado",
                    motivoRecusa: motivo,
                    dataAtualizacao: new Date().toISOString(),
                    analisadoPor: estadoSistema.usuarioInfo.nome,
                    dataAnalise: new Date().toISOString()
                });
                
                mostrarMensagem("✅ Candidatura APROVADA com sucesso!", "sucesso");
                
                document.getElementById('modalAnalise').classList.remove('ativo');
                candidaturaEmAnalise = null;
                
                atualizarDashboard();
                atualizarTabelaCandidatos();
                atualizarTabelaAnalise();
                
            } catch (error) {
                console.error("❌ Erro ao aprovar candidatura:", error);
                mostrarMensagem("Erro ao aprovar candidatura", "erro");
            }
        }

        async function recusarCandidatura() {
            if (!candidaturaEmAnalise) return;
            
            const motivo = document.getElementById('motivoDecisao').value.trim();
            if (!motivo) {
                mostrarMensagem("Informe o motivo da recusa", "aviso");
                return;
            }
            
            try {
                await atualizarCandidaturaFirebase(candidaturaEmAnalise.id, {
                    status: "recusado",
                    motivoRecusa: motivo,
                    dataAtualizacao: new Date().toISOString(),
                    analisadoPor: estadoSistema.usuarioInfo.nome,
                    dataAnalise: new Date().toISOString()
                });
                
                mostrarMensagem("❌ Candidatura RECUSADA com sucesso!", "sucesso");
                
                document.getElementById('modalAnalise').classList.remove('ativo');
                candidaturaEmAnalise = null;
                
                atualizarDashboard();
                atualizarTabelaCandidatos();
                atualizarTabelaAnalise();
                
            } catch (error) {
                console.error("❌ Erro ao recusar candidatura:", error);
                mostrarMensagem("Erro ao recusar candidatura", "erro");
            }
        }

        // Funções de Gerenciamento TSE
        function atualizarStatusEleicaoUI() {
            if (!document.getElementById('statusEleicao')) return;
            
            document.getElementById('statusEleicao').textContent = 
                estadoSistema.eleicaoAberta ? "SISTEMA ONLINE" : "SISTEMA OFFLINE";
            
            document.getElementById('btnAlternarEleicao').innerHTML = 
                estadoSistema.eleicaoAberta ? 
                '<i class="fas fa-power-off"></i> Desativar Sistema' : 
                '<i class="fas fa-power-off"></i> Ativar Sistema';
            
            document.getElementById('tipoEleicao').textContent = 
                estadoSistema.tipoEleicaoAtual ? 
                DADOS_SISTEMA.tiposEleicao[estadoSistema.tipoEleicaoAtual].nome.toUpperCase() : 
                "NÃO CONFIGURADO";
            
            if (document.getElementById('selectTipoEleicao')) {
                document.getElementById('selectTipoEleicao').value = estadoSistema.tipoEleicaoAtual || "";
            }
        }

        async function alternarStatusEleicao() {
            estadoSistema.eleicaoAberta = !estadoSistema.eleicaoAberta;
            
            await salvarConfiguracaoFirebase();
            atualizarStatusEleicaoUI();
            
            mostrarMensagem(
                estadoSistema.eleicaoAberta ? 
                "✅ Sistema ATIVADO - Candidaturas liberadas" : 
                "⏸️ Sistema DESATIVADO - Candidaturas bloqueadas",
                estadoSistema.eleicaoAberta ? "sucesso" : "aviso"
            );
        }

        function preencherTabelaPartidos() {
            const tbody = document.getElementById('tabelaPartidos');
            tbody.innerHTML = '';
            
            const todosPartidos = [
                ...DADOS_SISTEMA.partidos.direita.map(p => ({...p, ideologia: "Direita"})),
                ...DADOS_SISTEMA.partidos.centro.map(p => ({...p, ideologia: "Centro"})),
                ...DADOS_SISTEMA.partidos.esquerda.map(p => ({...p, ideologia: "Esquerda"}))
            ];
            
            todosPartidos.sort((a, b) => a.numero - b.numero);
            
            todosPartidos.forEach(partido => {
                const tr = document.createElement('tr');
                
                let corIdeologia = "";
                switch(partido.ideologia) {
                    case "Direita": corIdeologia = "var(--electric-blue)"; break;
                    case "Centro": corIdeologia = "var(--gold)"; break;
                    case "Esquerda": corIdeologia = "var(--warning-red)"; break;
                }
                
                tr.innerHTML = `
                    <td><strong>${partido.sigla}</strong></td>
                    <td><strong>${partido.numero}</strong></td>
                    <td>${partido.nome}</td>
                    <td>
                        <span class="status-badge" style="background: ${corIdeologia}; color: white;">
                            ${partido.ideologia}
                        </span>
                    </td>
                    <td>${partido.numero >= 80 ? "Fictício" : "Oficial"}</td>
                `;
                
                tbody.appendChild(tr);
            });
            
            document.getElementById('totalPartidos').textContent = todosPartidos.length;
        }

        // Funções de Exclusão (apenas TSE)
        function buscarCandidaturasParaExclusao() {
            const termo = document.getElementById('filtroExclusao').value.trim().toLowerCase();
            const resultadosDiv = document.getElementById('resultadosExclusao');
            
            if (!termo) {
                resultadosDiv.innerHTML = `
                    <div class="mensagem mensagem-aviso">
                        <i class="fas fa-info-circle"></i>
                        <div>Digite um termo para buscar candidaturas</div>
                    </div>
                `;
                return;
            }
            
            const resultados = estadoSistema.candidaturas.filter(c => 
                c.nome.toLowerCase().includes(termo) ||
                c.sobrenome.toLowerCase().includes(termo) ||
                c.partido.toLowerCase().includes(termo) ||
                c.numero.includes(termo) ||
                (c.coligacao && c.coligacao.some(p => p.toLowerCase().includes(termo)))
            );
            
            if (resultados.length === 0) {
                resultadosDiv.innerHTML = `
                    <div class="mensagem mensagem-aviso">
                        <i class="fas fa-search"></i>
                        <div>Nenhuma candidatura encontrada</div>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="mensagem mensagem-aviso">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div><strong>${resultados.length} candidatura(s) encontrada(s)</strong></div>
                </div>
                <div style="margin-top: 15px;">
            `;
            
            resultados.forEach(candidatura => {
                html += `
                    <div class="coligacao-item" style="justify-content: space-between;">
                        <div>
                            <strong>${candidatura.nome} ${candidatura.sobrenome}</strong><br>
                            <small>${candidatura.cargo} | ${candidatura.partido} | ${candidatura.numero}</small>
                        </div>
                        <button class="btn btn-pequeno" 
                                style="background: var(--warning-red); color: white;"
                                onclick="solicitarExclusao('${candidatura.id}')">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                `;
            });
            
            html += `</div>`;
            resultadosDiv.innerHTML = html;
        }

        function solicitarExclusao(id) {
            const candidatura = estadoSistema.candidaturas.find(c => c.id === id);
            if (!candidatura) return;
            
            candidaturaParaExcluir = candidatura;
            const modal = document.getElementById('modalExclusao');
            const conteudo = document.getElementById('conteudoModalExclusao');
            
            conteudo.innerHTML = `
                <div class="mensagem mensagem-aviso">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div><strong>ATENÇÃO: Esta ação é irreversível!</strong></div>
                </div>
                <div class="mt-20">
                    <p>Você está prestes a excluir permanentemente a candidatura de:</p>
                    <div class="card" style="margin-top: 10px;">
                        <h4>${candidatura.nome} ${candidatura.sobrenome}</h4>
                        <p>${candidatura.cargo} - ${candidatura.partido} (${candidatura.numero})</p>
                        <p>${candidatura.cidade} - ${candidatura.estado}</p>
                        <p>Status: ${candidatura.status === 'analise' ? 'Em Análise' : candidatura.status === 'aprovado' ? 'Aprovado' : 'Recusado'}</p>
                    </div>
                </div>
            `;
            
            modal.classList.add('ativo');
        }

        async function confirmarExclusao() {
            if (!candidaturaParaExcluir) return;
            
            const motivo = document.getElementById('motivoExclusao').value.trim();
            if (!motivo) {
                mostrarMensagem("Informe o motivo da exclusão", "aviso");
                return;
            }
            
            try {
                await excluirCandidaturaFirebase(candidaturaParaExcluir.id);
                
                mostrarMensagem("🗑️ Candidatura excluída permanentemente", "sucesso");
                
                document.getElementById('modalExclusao').classList.remove('ativo');
                document.getElementById('motivoExclusao').value = '';
                candidaturaParaExcluir = null;
                
                // Atualizar todas as visualizações
                atualizarDashboard();
                atualizarTabelaCandidatos();
                atualizarTabelaAnalise();
                
                // Limpar resultados da busca
                document.getElementById('resultadosExclusao').innerHTML = '';
                document.getElementById('filtroExclusao').value = '';
                
            } catch (error) {
                console.error("❌ Erro ao excluir candidatura:", error);
                mostrarMensagem("Erro ao excluir candidatura", "erro");
            }
        }

        // Funções Auxiliares
        function mostrarDetalhesCandidatura(id) {
            const candidatura = estadoSistema.candidaturas.find(c => c.id === id);
            if (!candidatura) return;
            
            const modal = document.getElementById('modalDetalhes');
            const conteudo = document.getElementById('conteudoModalDetalhes');
            
            // Encontrar informações do partido
            let partidoInfo = null;
            Object.values(DADOS_SISTEMA.partidos).flat().some(partido => {
                if (partido.sigla === candidatura.partido) {
                    partidoInfo = partido;
                    return true;
                }
                return false;
            });
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px;">
                    ${candidatura.fotoUrl ? 
                        `<img src="${candidatura.fotoUrl}" class="foto-preview" alt="Foto">` : 
                        `<div class="foto-placeholder">
                            <i class="fas fa-user-circle fa-3x"></i>
                        </div>`
                    }
                </div>
                <div class="form-grid">
                    <div class="filtro-group">
                        <label class="filtro-label">Candidato:</label>
                        <div><strong>${candidatura.nome} ${candidatura.sobrenome}</strong></div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">TikTok:</label>
                        <div>${candidatura.tiktok}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Cargo:</label>
                        <div>${candidatura.cargo}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Local:</label>
                        <div>${candidatura.cidade} - ${candidatura.estado}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Partido:</label>
                        <div>${partidoInfo ? `${partidoInfo.sigla} (${partidoInfo.numero}) - ${partidoInfo.nome}` : candidatura.partido}</div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Número:</label>
                        <div><strong>${candidatura.numero}</strong></div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Status:</label>
                        <div>
                            <span class="status-badge ${candidatura.status === 'analise' ? 'status-analise' : candidatura.status === 'aprovado' ? 'status-aprovado' : 'status-recusado'}">
                                ${candidatura.status === 'analise' ? 'EM ANÁLISE' : candidatura.status === 'aprovado' ? 'APROVADO' : 'RECUSADO'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="filtro-group">
                        <label class="filtro-label">Data de Registro:</label>
                        <div>${new Date(candidatura.dataRegistro).toLocaleDateString('pt-BR')}</div>
                    </div>
                </div>
            `;
            
            // Coligação
            if (candidatura.coligacao && candidatura.coligacao.length > 0) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Coligação:</h4>
                        <div class="form-grid">
                `;
                
                candidatura.coligacao.forEach(sigla => {
                    html += `<div class="filtro-group"><div>${sigla}</div></div>`;
                });
                
                html += `</div></div>`;
            }
            
            // Vice/Suplente
            if (candidatura.vice) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Vice:</h4>
                        <div class="form-grid">
                            <div class="filtro-group">
                                <label class="filtro-label">Nome:</label>
                                <div>${candidatura.vice.nome} ${candidatura.vice.sobrenome}</div>
                            </div>
                            <div class="filtro-group">
                                <label class="filtro-label">TikTok:</label>
                                <div>${candidatura.vice.tiktok || "Não informado"}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (candidatura.suplente) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Suplente:</h4>
                        <div class="form-grid">
                            <div class="filtro-group">
                                <label class="filtro-label">Nome:</label>
                                <div>${candidatura.suplente.nome} ${candidatura.suplente.sobrenome}</div>
                            </div>
                            <div class="filtro-group">
                                <label class="filtro-label">TikTok:</label>
                                <div>${candidatura.suplente.tiktok || "Não informado"}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Motivo da recusa (se aplicável)
            if (candidatura.status === "recusado" && candidatura.motivoRecusa) {
                html += `
                    <div class="mt-20">
                        <h4 class="filtro-label">Motivo da Recusa:</h4>
                        <div class="mensagem mensagem-erro">
                            <i class="fas fa-exclamation-circle"></i>
                            <div>${candidatura.motivoRecusa}</div>
                        </div>
                    </div>
                `;
            }
            
            conteudo.innerHTML = html;
            modal.classList.add('ativo');
        }

        function mostrarMensagem(texto, tipo) {
            // Criar ou reutilizar container de mensagens
            let container = document.getElementById('mensagensSistema');
            if (!container) {
                container = document.createElement('div');
                container.id = 'mensagensSistema';
                container.style.position = 'fixed';
                container.style.top = '20px';
                container.style.right = '20px';
                container.style.zIndex = '10000';
                document.body.appendChild(container);
            }
            
            // Criar mensagem
            const mensagem = document.createElement('div');
            mensagem.className = `mensagem mensagem-${tipo}`;
            mensagem.style.marginBottom = '10px';
            mensagem.style.minWidth = '300px';
            mensagem.style.maxWidth = '400px';
            mensagem.style.animation = 'hologramIn 0.3s ease';
            
            let icone = '';
            switch(tipo) {
                case 'sucesso': icone = 'fa-check-circle'; break;
                case 'erro': icone = 'fa-times-circle'; break;
                case 'aviso': icone = 'fa-exclamation-circle'; break;
                default: icone = 'fa-info-circle';
            }
            
            mensagem.innerHTML = `
                <i class="fas ${icone}"></i>
                <div>${texto}</div>
            `;
            
            container.appendChild(mensagem);
            
            // Remover automaticamente após 5 segundos
            setTimeout(() => {
                mensagem.style.opacity = '0';
                mensagem.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    if (mensagem.parentNode) {
                        mensagem.parentNode.removeChild(mensagem);
                    }
                }, 300);
            }, 5000);
        }

        // Exportar funções para o escopo global
        window.abrirModalAnalise = abrirModalAnalise;
        window.solicitarExclusao = solicitarExclusao;

        // Detectar dispositivo e ajustar layout
        function detectarDispositivo() {
            const isMobile = window.innerWidth <= 768;
            document.body.classList.toggle('mobile', isMobile);
            document.body.classList.toggle('desktop', !isMobile);
        }

        window.addEventListener('resize', detectarDispositivo);
        detectarDispositivo();
    </script>
</body>
</html>
